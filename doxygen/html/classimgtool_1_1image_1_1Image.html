<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Leshan-OMA-Lightweight-M2M-server-for-Zephyr: Image Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Leshan-OMA-Lightweight-M2M-server-for-Zephyr
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classimgtool_1_1image_1_1Image.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle"><div class="title">Image Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7c70226e980f376a414433a572c5c74f" id="r_a7c70226e980f376a414433a572c5c74f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7c70226e980f376a414433a572c5c74f">__init__</a> (self, <a class="el" href="#a4c7a521b8f1a0769c09bfa4a1fca7dab">version</a>=None, <a class="el" href="#aa6505cb356927cbac12d2af8dac8651b">header_size</a>=<a class="el" href="namespaceimgtool_1_1image.html#a4efed0f255ac85cda9b453fd1c554fc8">IMAGE_HEADER_SIZE</a>, <a class="el" href="#ab93b5446e5640d11ee66e87a5a347e30">pad_header</a>=False, <a class="el" href="#a85ab2d9278949e16f4c77f1b5daf342d">pad</a>=False, <a class="el" href="#a80eab7ef497bc82f028bda0b735f7727">confirm</a>=False, <a class="el" href="#a6c52c4bac77f6744fdc338766e9e8a6f">align</a>=1, <a class="el" href="#aa688bccf026647ce81122f09a9dd5d37">slot_size</a>=0, <a class="el" href="#aba7c3d70c64b6a3e93ebcc28e2c36521">max_sectors</a>=<a class="el" href="namespaceimgtool_1_1image.html#a9b7887d4c82a482eb06ff2272c7fba07">DEFAULT_MAX_SECTORS</a>, <a class="el" href="#ad3c66df158b3cb95366d7639fd66e7fb">overwrite_only</a>=False, <a class="el" href="#aceb52d5e58265d474290d1e17bcf1716">endian</a>=&quot;little&quot;, <a class="el" href="#a0ece5abf498c14f7e723a0ea201f2356">load_addr</a>=0, <a class="el" href="#ac1fe150a3ea42a43271e6bec10231675">rom_fixed</a>=None, <a class="el" href="#a5fc1d58df4dc5f022d49e58729217aaa">erased_val</a>=None, <a class="el" href="#ab3196255cca37d29a5ed0ac49c417129">save_enctlv</a>=False, <a class="el" href="#a8e2f7509fd83c863081352c1c941a835">security_counter</a>=None, <a class="el" href="#ab3751a7bf9489f96727a62232ad9d7d5">max_align</a>=None)</td></tr>
<tr class="separator:a7c70226e980f376a414433a572c5c74f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61a1f3a6a4df93d491cd753f617782a2" id="r_a61a1f3a6a4df93d491cd753f617782a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a61a1f3a6a4df93d491cd753f617782a2">__repr__</a> (self)</td></tr>
<tr class="separator:a61a1f3a6a4df93d491cd753f617782a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae9853a9699155c034c6dd57551bcca4" id="r_aae9853a9699155c034c6dd57551bcca4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aae9853a9699155c034c6dd57551bcca4">load</a> (self, path)</td></tr>
<tr class="separator:aae9853a9699155c034c6dd57551bcca4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dfc4f3822963e9ea5dc5d02509a6ac7" id="r_a2dfc4f3822963e9ea5dc5d02509a6ac7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2dfc4f3822963e9ea5dc5d02509a6ac7">save</a> (self, path, hex_addr=None)</td></tr>
<tr class="separator:a2dfc4f3822963e9ea5dc5d02509a6ac7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c800cde66f3f0bbdf3fe1ef07b292b2" id="r_a3c800cde66f3f0bbdf3fe1ef07b292b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c800cde66f3f0bbdf3fe1ef07b292b2">check_header</a> (self)</td></tr>
<tr class="separator:a3c800cde66f3f0bbdf3fe1ef07b292b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9e70f9f24dac287273b74b0c7e561aa" id="r_ac9e70f9f24dac287273b74b0c7e561aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac9e70f9f24dac287273b74b0c7e561aa">check_trailer</a> (self)</td></tr>
<tr class="separator:ac9e70f9f24dac287273b74b0c7e561aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6923ecc13ffce53c3d1179e8704f6c" id="r_a1f6923ecc13ffce53c3d1179e8704f6c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f6923ecc13ffce53c3d1179e8704f6c">ecies_hkdf</a> (self, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, plainkey)</td></tr>
<tr class="separator:a1f6923ecc13ffce53c3d1179e8704f6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a5f7227fab39547130f389b75907f1d" id="r_a3a5f7227fab39547130f389b75907f1d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3a5f7227fab39547130f389b75907f1d">create</a> (self, key, public_key_format, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, dependencies=None, sw_type=None, custom_tlvs=None, encrypt_keylen=128, clear=False)</td></tr>
<tr class="separator:a3a5f7227fab39547130f389b75907f1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25e0c88e7d9209d7217d2b63e7b3d48b" id="r_a25e0c88e7d9209d7217d2b63e7b3d48b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a25e0c88e7d9209d7217d2b63e7b3d48b">add_header</a> (self, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, protected_tlv_size, aes_length=128)</td></tr>
<tr class="separator:a25e0c88e7d9209d7217d2b63e7b3d48b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d90e9f0f17d4fb607d4741af0483ca" id="r_a02d90e9f0f17d4fb607d4741af0483ca"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a02d90e9f0f17d4fb607d4741af0483ca">pad_to</a> (self, size)</td></tr>
<tr class="separator:a02d90e9f0f17d4fb607d4741af0483ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fe29c529ae3b9877393874ebfa99772" id="r_a7fe29c529ae3b9877393874ebfa99772"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7fe29c529ae3b9877393874ebfa99772">__init__</a> (self, <a class="el" href="#a4c7a521b8f1a0769c09bfa4a1fca7dab">version</a>=None, <a class="el" href="#aa6505cb356927cbac12d2af8dac8651b">header_size</a>=<a class="el" href="namespaceimgtool_1_1image.html#a4efed0f255ac85cda9b453fd1c554fc8">IMAGE_HEADER_SIZE</a>, <a class="el" href="#ab93b5446e5640d11ee66e87a5a347e30">pad_header</a>=False, <a class="el" href="#a85ab2d9278949e16f4c77f1b5daf342d">pad</a>=False, <a class="el" href="#a80eab7ef497bc82f028bda0b735f7727">confirm</a>=False, <a class="el" href="#a6c52c4bac77f6744fdc338766e9e8a6f">align</a>=1, <a class="el" href="#aa688bccf026647ce81122f09a9dd5d37">slot_size</a>=0, <a class="el" href="#aba7c3d70c64b6a3e93ebcc28e2c36521">max_sectors</a>=<a class="el" href="namespaceimgtool_1_1image.html#a9b7887d4c82a482eb06ff2272c7fba07">DEFAULT_MAX_SECTORS</a>, <a class="el" href="#ad3c66df158b3cb95366d7639fd66e7fb">overwrite_only</a>=False, <a class="el" href="#aceb52d5e58265d474290d1e17bcf1716">endian</a>=&quot;little&quot;, <a class="el" href="#a0ece5abf498c14f7e723a0ea201f2356">load_addr</a>=0, <a class="el" href="#ac1fe150a3ea42a43271e6bec10231675">rom_fixed</a>=None, <a class="el" href="#a5fc1d58df4dc5f022d49e58729217aaa">erased_val</a>=None, <a class="el" href="#ab3196255cca37d29a5ed0ac49c417129">save_enctlv</a>=False, <a class="el" href="#a8e2f7509fd83c863081352c1c941a835">security_counter</a>=None)</td></tr>
<tr class="separator:a7fe29c529ae3b9877393874ebfa99772"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61a1f3a6a4df93d491cd753f617782a2" id="r_a61a1f3a6a4df93d491cd753f617782a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a61a1f3a6a4df93d491cd753f617782a2">__repr__</a> (self)</td></tr>
<tr class="separator:a61a1f3a6a4df93d491cd753f617782a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae9853a9699155c034c6dd57551bcca4" id="r_aae9853a9699155c034c6dd57551bcca4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aae9853a9699155c034c6dd57551bcca4">load</a> (self, path)</td></tr>
<tr class="separator:aae9853a9699155c034c6dd57551bcca4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dfc4f3822963e9ea5dc5d02509a6ac7" id="r_a2dfc4f3822963e9ea5dc5d02509a6ac7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2dfc4f3822963e9ea5dc5d02509a6ac7">save</a> (self, path, hex_addr=None)</td></tr>
<tr class="separator:a2dfc4f3822963e9ea5dc5d02509a6ac7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c800cde66f3f0bbdf3fe1ef07b292b2" id="r_a3c800cde66f3f0bbdf3fe1ef07b292b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c800cde66f3f0bbdf3fe1ef07b292b2">check_header</a> (self)</td></tr>
<tr class="separator:a3c800cde66f3f0bbdf3fe1ef07b292b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9e70f9f24dac287273b74b0c7e561aa" id="r_ac9e70f9f24dac287273b74b0c7e561aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac9e70f9f24dac287273b74b0c7e561aa">check_trailer</a> (self)</td></tr>
<tr class="separator:ac9e70f9f24dac287273b74b0c7e561aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6923ecc13ffce53c3d1179e8704f6c" id="r_a1f6923ecc13ffce53c3d1179e8704f6c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f6923ecc13ffce53c3d1179e8704f6c">ecies_hkdf</a> (self, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, plainkey)</td></tr>
<tr class="separator:a1f6923ecc13ffce53c3d1179e8704f6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a155839d5783a4431339f399eaf9eea69" id="r_a155839d5783a4431339f399eaf9eea69"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a155839d5783a4431339f399eaf9eea69">create</a> (self, key, public_key_format, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, dependencies=None, sw_type=None, custom_tlvs=None)</td></tr>
<tr class="separator:a155839d5783a4431339f399eaf9eea69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e5f77647e2f4f878f22391acfd89e24" id="r_a5e5f77647e2f4f878f22391acfd89e24"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e5f77647e2f4f878f22391acfd89e24">add_header</a> (self, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, protected_tlv_size)</td></tr>
<tr class="separator:a5e5f77647e2f4f878f22391acfd89e24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d90e9f0f17d4fb607d4741af0483ca" id="r_a02d90e9f0f17d4fb607d4741af0483ca"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a02d90e9f0f17d4fb607d4741af0483ca">pad_to</a> (self, size)</td></tr>
<tr class="separator:a02d90e9f0f17d4fb607d4741af0483ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac250de8e12b6915166834bc0be6eff8b" id="r_ac250de8e12b6915166834bc0be6eff8b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac250de8e12b6915166834bc0be6eff8b">verify</a> (imgfile, key)</td></tr>
<tr class="separator:ac250de8e12b6915166834bc0be6eff8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac250de8e12b6915166834bc0be6eff8b" id="r_ac250de8e12b6915166834bc0be6eff8b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac250de8e12b6915166834bc0be6eff8b">verify</a> (imgfile, key)</td></tr>
<tr class="separator:ac250de8e12b6915166834bc0be6eff8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a4c7a521b8f1a0769c09bfa4a1fca7dab" id="r_a4c7a521b8f1a0769c09bfa4a1fca7dab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4c7a521b8f1a0769c09bfa4a1fca7dab">version</a></td></tr>
<tr class="separator:a4c7a521b8f1a0769c09bfa4a1fca7dab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6505cb356927cbac12d2af8dac8651b" id="r_aa6505cb356927cbac12d2af8dac8651b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa6505cb356927cbac12d2af8dac8651b">header_size</a></td></tr>
<tr class="separator:aa6505cb356927cbac12d2af8dac8651b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab93b5446e5640d11ee66e87a5a347e30" id="r_ab93b5446e5640d11ee66e87a5a347e30"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab93b5446e5640d11ee66e87a5a347e30">pad_header</a></td></tr>
<tr class="separator:ab93b5446e5640d11ee66e87a5a347e30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85ab2d9278949e16f4c77f1b5daf342d" id="r_a85ab2d9278949e16f4c77f1b5daf342d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85ab2d9278949e16f4c77f1b5daf342d">pad</a></td></tr>
<tr class="separator:a85ab2d9278949e16f4c77f1b5daf342d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80eab7ef497bc82f028bda0b735f7727" id="r_a80eab7ef497bc82f028bda0b735f7727"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a80eab7ef497bc82f028bda0b735f7727">confirm</a></td></tr>
<tr class="separator:a80eab7ef497bc82f028bda0b735f7727"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c52c4bac77f6744fdc338766e9e8a6f" id="r_a6c52c4bac77f6744fdc338766e9e8a6f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6c52c4bac77f6744fdc338766e9e8a6f">align</a></td></tr>
<tr class="separator:a6c52c4bac77f6744fdc338766e9e8a6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa688bccf026647ce81122f09a9dd5d37" id="r_aa688bccf026647ce81122f09a9dd5d37"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa688bccf026647ce81122f09a9dd5d37">slot_size</a></td></tr>
<tr class="separator:aa688bccf026647ce81122f09a9dd5d37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7c3d70c64b6a3e93ebcc28e2c36521" id="r_aba7c3d70c64b6a3e93ebcc28e2c36521"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aba7c3d70c64b6a3e93ebcc28e2c36521">max_sectors</a></td></tr>
<tr class="separator:aba7c3d70c64b6a3e93ebcc28e2c36521"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3c66df158b3cb95366d7639fd66e7fb" id="r_ad3c66df158b3cb95366d7639fd66e7fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad3c66df158b3cb95366d7639fd66e7fb">overwrite_only</a></td></tr>
<tr class="separator:ad3c66df158b3cb95366d7639fd66e7fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aceb52d5e58265d474290d1e17bcf1716" id="r_aceb52d5e58265d474290d1e17bcf1716"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aceb52d5e58265d474290d1e17bcf1716">endian</a></td></tr>
<tr class="separator:aceb52d5e58265d474290d1e17bcf1716"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22ab7e27a72864f768a6b755eda2ccfb" id="r_a22ab7e27a72864f768a6b755eda2ccfb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a22ab7e27a72864f768a6b755eda2ccfb">base_addr</a></td></tr>
<tr class="separator:a22ab7e27a72864f768a6b755eda2ccfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ece5abf498c14f7e723a0ea201f2356" id="r_a0ece5abf498c14f7e723a0ea201f2356"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0ece5abf498c14f7e723a0ea201f2356">load_addr</a></td></tr>
<tr class="separator:a0ece5abf498c14f7e723a0ea201f2356"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1fe150a3ea42a43271e6bec10231675" id="r_ac1fe150a3ea42a43271e6bec10231675"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac1fe150a3ea42a43271e6bec10231675">rom_fixed</a></td></tr>
<tr class="separator:ac1fe150a3ea42a43271e6bec10231675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fc1d58df4dc5f022d49e58729217aaa" id="r_a5fc1d58df4dc5f022d49e58729217aaa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5fc1d58df4dc5f022d49e58729217aaa">erased_val</a></td></tr>
<tr class="separator:a5fc1d58df4dc5f022d49e58729217aaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeabb6226e68bbbbb995aa6af5d999d11" id="r_aeabb6226e68bbbbb995aa6af5d999d11"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeabb6226e68bbbbb995aa6af5d999d11">payload</a></td></tr>
<tr class="separator:aeabb6226e68bbbbb995aa6af5d999d11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f829b459875878369da661bb9d9abda" id="r_a9f829b459875878369da661bb9d9abda"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a></td></tr>
<tr class="separator:a9f829b459875878369da661bb9d9abda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3196255cca37d29a5ed0ac49c417129" id="r_ab3196255cca37d29a5ed0ac49c417129"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab3196255cca37d29a5ed0ac49c417129">save_enctlv</a></td></tr>
<tr class="separator:ab3196255cca37d29a5ed0ac49c417129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a651723b133106cb91db016c5b634a7b6" id="r_a651723b133106cb91db016c5b634a7b6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a651723b133106cb91db016c5b634a7b6">enctlv_len</a></td></tr>
<tr class="separator:a651723b133106cb91db016c5b634a7b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3751a7bf9489f96727a62232ad9d7d5" id="r_ab3751a7bf9489f96727a62232ad9d7d5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab3751a7bf9489f96727a62232ad9d7d5">max_align</a></td></tr>
<tr class="separator:ab3751a7bf9489f96727a62232ad9d7d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f6749af3466b82f4c8a02db32d05393" id="r_a2f6749af3466b82f4c8a02db32d05393"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f6749af3466b82f4c8a02db32d05393">boot_magic</a></td></tr>
<tr class="separator:a2f6749af3466b82f4c8a02db32d05393"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e2f7509fd83c863081352c1c941a835" id="r_a8e2f7509fd83c863081352c1c941a835"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e2f7509fd83c863081352c1c941a835">security_counter</a></td></tr>
<tr class="separator:a8e2f7509fd83c863081352c1c941a835"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a0cf4a46f0aec2fd17d70c5ccf571d8c8" id="r_a0cf4a46f0aec2fd17d70c5ccf571d8c8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0cf4a46f0aec2fd17d70c5ccf571d8c8">_trailer_size</a> (self, write_size, <a class="el" href="#aba7c3d70c64b6a3e93ebcc28e2c36521">max_sectors</a>, <a class="el" href="#ad3c66df158b3cb95366d7639fd66e7fb">overwrite_only</a>, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, <a class="el" href="#ab3196255cca37d29a5ed0ac49c417129">save_enctlv</a>, <a class="el" href="#a651723b133106cb91db016c5b634a7b6">enctlv_len</a>)</td></tr>
<tr class="separator:a0cf4a46f0aec2fd17d70c5ccf571d8c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cf4a46f0aec2fd17d70c5ccf571d8c8" id="r_a0cf4a46f0aec2fd17d70c5ccf571d8c8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0cf4a46f0aec2fd17d70c5ccf571d8c8">_trailer_size</a> (self, write_size, <a class="el" href="#aba7c3d70c64b6a3e93ebcc28e2c36521">max_sectors</a>, <a class="el" href="#ad3c66df158b3cb95366d7639fd66e7fb">overwrite_only</a>, <a class="el" href="#a9f829b459875878369da661bb9d9abda">enckey</a>, <a class="el" href="#ab3196255cca37d29a5ed0ac49c417129">save_enctlv</a>, <a class="el" href="#a651723b133106cb91db016c5b634a7b6">enctlv_len</a>)</td></tr>
<tr class="separator:a0cf4a46f0aec2fd17d70c5ccf571d8c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00128">128</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7c70226e980f376a414433a572c5c74f" name="a7c70226e980f376a414433a572c5c74f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c70226e980f376a414433a572c5c74f">&#9670;&#160;</a></span>__init__() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__init__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>version</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>header_size</em><span class="paramdefsep"> = </span><span class="paramdefval"><a class="el" href="namespaceimgtool_1_1image.html#a4efed0f255ac85cda9b453fd1c554fc8">IMAGE_HEADER_SIZE</a></span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>pad_header</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>pad</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>confirm</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>align</em><span class="paramdefsep"> = </span><span class="paramdefval">1</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>slot_size</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_sectors</em><span class="paramdefsep"> = </span><span class="paramdefval"><a class="el" href="namespaceimgtool_1_1image.html#a9b7887d4c82a482eb06ff2272c7fba07">DEFAULT_MAX_SECTORS</a></span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>overwrite_only</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>endian</em><span class="paramdefsep"> = </span><span class="paramdefval">&quot;little&quot;</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>load_addr</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>rom_fixed</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>erased_val</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>save_enctlv</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>security_counter</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_align</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00130">130</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  135</span>                 security_counter=<span class="keywordtype">None</span>, max_align=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>        <span class="keywordflow">if</span> load_addr <span class="keywordflow">and</span> rom_fixed:</div>
<div class="line"><span class="lineno">  138</span>            <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;Can not set rom_fixed and load_addr at the same time&quot;</span>)</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>        self.version = version <span class="keywordflow">or</span> versmod.decode_version(<span class="stringliteral">&quot;0&quot;</span>)</div>
<div class="line"><span class="lineno">  141</span>        self.header_size = header_size</div>
<div class="line"><span class="lineno">  142</span>        self.pad_header = pad_header</div>
<div class="line"><span class="lineno">  143</span>        self.pad = pad</div>
<div class="line"><span class="lineno">  144</span>        self.confirm = confirm</div>
<div class="line"><span class="lineno">  145</span>        self.align = align</div>
<div class="line"><span class="lineno">  146</span>        self.slot_size = slot_size</div>
<div class="line"><span class="lineno">  147</span>        self.max_sectors = max_sectors</div>
<div class="line"><span class="lineno">  148</span>        self.overwrite_only = overwrite_only</div>
<div class="line"><span class="lineno">  149</span>        self.endian = endian</div>
<div class="line"><span class="lineno">  150</span>        self.base_addr = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  151</span>        self.load_addr = 0 <span class="keywordflow">if</span> load_addr <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> load_addr</div>
<div class="line"><span class="lineno">  152</span>        self.rom_fixed = rom_fixed</div>
<div class="line"><span class="lineno">  153</span>        self.erased_val = 0xff <span class="keywordflow">if</span> erased_val <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> int(erased_val, 0)</div>
<div class="line"><span class="lineno">  154</span>        self.payload = []</div>
<div class="line"><span class="lineno">  155</span>        self.enckey = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  156</span>        self.save_enctlv = save_enctlv</div>
<div class="line"><span class="lineno">  157</span>        self.enctlv_len = 0</div>
<div class="line"><span class="lineno">  158</span>        self.max_align = max(DEFAULT_MAX_ALIGN, align) <span class="keywordflow">if</span> max_align <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> int(max_align)</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>        <span class="keywordflow">if</span> self.max_align == DEFAULT_MAX_ALIGN:</div>
<div class="line"><span class="lineno">  161</span>            self.boot_magic = bytes([</div>
<div class="line"><span class="lineno">  162</span>                0x77, 0xc2, 0x95, 0xf3,</div>
<div class="line"><span class="lineno">  163</span>                0x60, 0xd2, 0xef, 0x7f,</div>
<div class="line"><span class="lineno">  164</span>                0x35, 0x52, 0x50, 0x0f,</div>
<div class="line"><span class="lineno">  165</span>                0x2c, 0xb6, 0x79, 0x80, ])</div>
<div class="line"><span class="lineno">  166</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  167</span>            align_lsb = self.max_align &amp; 0x00ff</div>
<div class="line"><span class="lineno">  168</span>            align_msb = (self.max_align &amp; 0xff00) &gt;&gt; 8</div>
<div class="line"><span class="lineno">  169</span>            self.boot_magic = bytes([</div>
<div class="line"><span class="lineno">  170</span>                align_lsb, align_msb, 0x2d, 0xe1,</div>
<div class="line"><span class="lineno">  171</span>                0x5d, 0x29, 0x41, 0x0b,</div>
<div class="line"><span class="lineno">  172</span>                0x8d, 0x77, 0x67, 0x9c,</div>
<div class="line"><span class="lineno">  173</span>                0x11, 0x0f, 0x1f, 0x8a, ])</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>        <span class="keywordflow">if</span> security_counter == <span class="stringliteral">&#39;auto&#39;</span>:</div>
<div class="line"><span class="lineno">  176</span>            <span class="comment"># Security counter has not been explicitly provided,</span></div>
<div class="line"><span class="lineno">  177</span>            <span class="comment"># generate it from the version number</span></div>
<div class="line"><span class="lineno">  178</span>            self.security_counter = ((self.version.major &lt;&lt; 24)</div>
<div class="line"><span class="lineno">  179</span>                                     + (self.version.minor &lt;&lt; 16)</div>
<div class="line"><span class="lineno">  180</span>                                     + self.version.revision)</div>
<div class="line"><span class="lineno">  181</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  182</span>            self.security_counter = security_counter</div>
<div class="line"><span class="lineno">  183</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a7fe29c529ae3b9877393874ebfa99772" name="a7fe29c529ae3b9877393874ebfa99772"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fe29c529ae3b9877393874ebfa99772">&#9670;&#160;</a></span>__init__() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__init__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>version</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>header_size</em><span class="paramdefsep"> = </span><span class="paramdefval"><a class="el" href="namespaceimgtool_1_1image.html#a4efed0f255ac85cda9b453fd1c554fc8">IMAGE_HEADER_SIZE</a></span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>pad_header</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>pad</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>confirm</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>align</em><span class="paramdefsep"> = </span><span class="paramdefval">1</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>slot_size</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_sectors</em><span class="paramdefsep"> = </span><span class="paramdefval"><a class="el" href="namespaceimgtool_1_1image.html#a9b7887d4c82a482eb06ff2272c7fba07">DEFAULT_MAX_SECTORS</a></span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>overwrite_only</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>endian</em><span class="paramdefsep"> = </span><span class="paramdefval">&quot;little&quot;</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>load_addr</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>rom_fixed</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>erased_val</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>save_enctlv</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>security_counter</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00130">130</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  135</span>                 security_counter=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>        <span class="keywordflow">if</span> load_addr <span class="keywordflow">and</span> rom_fixed:</div>
<div class="line"><span class="lineno">  138</span>            <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;Can not set rom_fixed and load_addr at the same time&quot;</span>)</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>        self.version = version <span class="keywordflow">or</span> versmod.decode_version(<span class="stringliteral">&quot;0&quot;</span>)</div>
<div class="line"><span class="lineno">  141</span>        self.header_size = header_size</div>
<div class="line"><span class="lineno">  142</span>        self.pad_header = pad_header</div>
<div class="line"><span class="lineno">  143</span>        self.pad = pad</div>
<div class="line"><span class="lineno">  144</span>        self.confirm = confirm</div>
<div class="line"><span class="lineno">  145</span>        self.align = align</div>
<div class="line"><span class="lineno">  146</span>        self.slot_size = slot_size</div>
<div class="line"><span class="lineno">  147</span>        self.max_sectors = max_sectors</div>
<div class="line"><span class="lineno">  148</span>        self.overwrite_only = overwrite_only</div>
<div class="line"><span class="lineno">  149</span>        self.endian = endian</div>
<div class="line"><span class="lineno">  150</span>        self.base_addr = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  151</span>        self.load_addr = 0 <span class="keywordflow">if</span> load_addr <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> load_addr</div>
<div class="line"><span class="lineno">  152</span>        self.rom_fixed = rom_fixed</div>
<div class="line"><span class="lineno">  153</span>        self.erased_val = 0xff <span class="keywordflow">if</span> erased_val <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> int(erased_val, 0)</div>
<div class="line"><span class="lineno">  154</span>        self.payload = []</div>
<div class="line"><span class="lineno">  155</span>        self.enckey = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  156</span>        self.save_enctlv = save_enctlv</div>
<div class="line"><span class="lineno">  157</span>        self.enctlv_len = 0</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>        <span class="keywordflow">if</span> security_counter == <span class="stringliteral">&#39;auto&#39;</span>:</div>
<div class="line"><span class="lineno">  160</span>            <span class="comment"># Security counter has not been explicitly provided,</span></div>
<div class="line"><span class="lineno">  161</span>            <span class="comment"># generate it from the version number</span></div>
<div class="line"><span class="lineno">  162</span>            self.security_counter = ((self.version.major &lt;&lt; 24)</div>
<div class="line"><span class="lineno">  163</span>                                     + (self.version.minor &lt;&lt; 16)</div>
<div class="line"><span class="lineno">  164</span>                                     + self.version.revision)</div>
<div class="line"><span class="lineno">  165</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  166</span>            self.security_counter = security_counter</div>
<div class="line"><span class="lineno">  167</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a61a1f3a6a4df93d491cd753f617782a2" name="a61a1f3a6a4df93d491cd753f617782a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61a1f3a6a4df93d491cd753f617782a2">&#9670;&#160;</a></span>__repr__() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__repr__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00184">184</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  184</span>    <span class="keyword">def </span>__repr__(self):</div>
<div class="line"><span class="lineno">  185</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;Image version={}, header_size={}, security_counter={}, \</span></div>
<div class="line"><span class="lineno">  186</span><span class="stringliteral">                base_addr={}, load_addr={}, align={}, slot_size={}, \</span></div>
<div class="line"><span class="lineno">  187</span><span class="stringliteral">                max_sectors={}, overwrite_only={}, endian={} format={}, \</span></div>
<div class="line"><span class="lineno">  188</span><span class="stringliteral">                payloadlen=0x{:x}&gt;&quot;</span>.format(</div>
<div class="line"><span class="lineno">  189</span>                    self.version,</div>
<div class="line"><span class="lineno">  190</span>                    self.header_size,</div>
<div class="line"><span class="lineno">  191</span>                    self.security_counter,</div>
<div class="line"><span class="lineno">  192</span>                    self.base_addr <span class="keywordflow">if</span> self.base_addr <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> <span class="stringliteral">&quot;N/A&quot;</span>,</div>
<div class="line"><span class="lineno">  193</span>                    self.load_addr,</div>
<div class="line"><span class="lineno">  194</span>                    self.align,</div>
<div class="line"><span class="lineno">  195</span>                    self.slot_size,</div>
<div class="line"><span class="lineno">  196</span>                    self.max_sectors,</div>
<div class="line"><span class="lineno">  197</span>                    self.overwrite_only,</div>
<div class="line"><span class="lineno">  198</span>                    self.endian,</div>
<div class="line"><span class="lineno">  199</span>                    self.__class__.__name__,</div>
<div class="line"><span class="lineno">  200</span>                    len(self.payload))</div>
<div class="line"><span class="lineno">  201</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a61a1f3a6a4df93d491cd753f617782a2" name="a61a1f3a6a4df93d491cd753f617782a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61a1f3a6a4df93d491cd753f617782a2">&#9670;&#160;</a></span>__repr__() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__repr__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00168">168</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  168</span>    <span class="keyword">def </span>__repr__(self):</div>
<div class="line"><span class="lineno">  169</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;Image version={}, header_size={}, security_counter={}, \</span></div>
<div class="line"><span class="lineno">  170</span><span class="stringliteral">                base_addr={}, load_addr={}, align={}, slot_size={}, \</span></div>
<div class="line"><span class="lineno">  171</span><span class="stringliteral">                max_sectors={}, overwrite_only={}, endian={} format={}, \</span></div>
<div class="line"><span class="lineno">  172</span><span class="stringliteral">                payloadlen=0x{:x}&gt;&quot;</span>.format(</div>
<div class="line"><span class="lineno">  173</span>                    self.version,</div>
<div class="line"><span class="lineno">  174</span>                    self.header_size,</div>
<div class="line"><span class="lineno">  175</span>                    self.security_counter,</div>
<div class="line"><span class="lineno">  176</span>                    self.base_addr <span class="keywordflow">if</span> self.base_addr <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> <span class="stringliteral">&quot;N/A&quot;</span>,</div>
<div class="line"><span class="lineno">  177</span>                    self.load_addr,</div>
<div class="line"><span class="lineno">  178</span>                    self.align,</div>
<div class="line"><span class="lineno">  179</span>                    self.slot_size,</div>
<div class="line"><span class="lineno">  180</span>                    self.max_sectors,</div>
<div class="line"><span class="lineno">  181</span>                    self.overwrite_only,</div>
<div class="line"><span class="lineno">  182</span>                    self.endian,</div>
<div class="line"><span class="lineno">  183</span>                    self.__class__.__name__,</div>
<div class="line"><span class="lineno">  184</span>                    len(self.payload))</div>
<div class="line"><span class="lineno">  185</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0cf4a46f0aec2fd17d70c5ccf571d8c8" name="a0cf4a46f0aec2fd17d70c5ccf571d8c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf4a46f0aec2fd17d70c5ccf571d8c8">&#9670;&#160;</a></span>_trailer_size() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_trailer_size </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>write_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_sectors</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>overwrite_only</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>save_enctlv</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enctlv_len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00533">533</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  534</span>                      save_enctlv, enctlv_len):</div>
<div class="line"><span class="lineno">  535</span>        <span class="comment"># NOTE: should already be checked by the argument parser</span></div>
<div class="line"><span class="lineno">  536</span>        magic_size = 16</div>
<div class="line"><span class="lineno">  537</span>        magic_align_size = align_up(magic_size, self.max_align)</div>
<div class="line"><span class="lineno">  538</span>        <span class="keywordflow">if</span> overwrite_only:</div>
<div class="line"><span class="lineno">  539</span>            <span class="keywordflow">return</span> self.max_align * 2 + magic_align_size</div>
<div class="line"><span class="lineno">  540</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  541</span>            <span class="keywordflow">if</span> write_size <span class="keywordflow">not</span> <span class="keywordflow">in</span> set([1, 2, 4, 8, 16, 32]):</div>
<div class="line"><span class="lineno">  542</span>                <span class="keywordflow">raise</span> click.BadParameter(<span class="stringliteral">&quot;Invalid alignment: {}&quot;</span>.format(</div>
<div class="line"><span class="lineno">  543</span>                    write_size))</div>
<div class="line"><span class="lineno">  544</span>            m = DEFAULT_MAX_SECTORS <span class="keywordflow">if</span> max_sectors <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> max_sectors</div>
<div class="line"><span class="lineno">  545</span>            trailer = m * 3 * write_size  <span class="comment"># status area</span></div>
<div class="line"><span class="lineno">  546</span>            <span class="keywordflow">if</span> enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  547</span>                <span class="keywordflow">if</span> save_enctlv:</div>
<div class="line"><span class="lineno">  548</span>                    <span class="comment"># TLV saved by the bootloader is aligned</span></div>
<div class="line"><span class="lineno">  549</span>                    keylen = align_up(enctlv_len, self.max_align)</div>
<div class="line"><span class="lineno">  550</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  551</span>                    keylen = align_up(16, self.max_align)</div>
<div class="line"><span class="lineno">  552</span>                trailer += keylen * 2  <span class="comment"># encryption keys</span></div>
<div class="line"><span class="lineno">  553</span>            trailer += self.max_align * 4  <span class="comment"># image_ok/copy_done/swap_info/swap_size</span></div>
<div class="line"><span class="lineno">  554</span>            trailer += magic_align_size</div>
<div class="line"><span class="lineno">  555</span>            <span class="keywordflow">return</span> trailer</div>
<div class="line"><span class="lineno">  556</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0cf4a46f0aec2fd17d70c5ccf571d8c8" name="a0cf4a46f0aec2fd17d70c5ccf571d8c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf4a46f0aec2fd17d70c5ccf571d8c8">&#9670;&#160;</a></span>_trailer_size() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_trailer_size </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>write_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_sectors</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>overwrite_only</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>save_enctlv</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enctlv_len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00504">504</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  505</span>                      save_enctlv, enctlv_len):</div>
<div class="line"><span class="lineno">  506</span>        <span class="comment"># NOTE: should already be checked by the argument parser</span></div>
<div class="line"><span class="lineno">  507</span>        magic_size = 16</div>
<div class="line"><span class="lineno">  508</span>        <span class="keywordflow">if</span> overwrite_only:</div>
<div class="line"><span class="lineno">  509</span>            <span class="keywordflow">return</span> MAX_ALIGN * 2 + magic_size</div>
<div class="line"><span class="lineno">  510</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  511</span>            <span class="keywordflow">if</span> write_size <span class="keywordflow">not</span> <span class="keywordflow">in</span> set([1, 2, 4, 8]):</div>
<div class="line"><span class="lineno">  512</span>                <span class="keywordflow">raise</span> click.BadParameter(<span class="stringliteral">&quot;Invalid alignment: {}&quot;</span>.format(</div>
<div class="line"><span class="lineno">  513</span>                    write_size))</div>
<div class="line"><span class="lineno">  514</span>            m = DEFAULT_MAX_SECTORS <span class="keywordflow">if</span> max_sectors <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> max_sectors</div>
<div class="line"><span class="lineno">  515</span>            trailer = m * 3 * write_size  <span class="comment"># status area</span></div>
<div class="line"><span class="lineno">  516</span>            <span class="keywordflow">if</span> enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  517</span>                <span class="keywordflow">if</span> save_enctlv:</div>
<div class="line"><span class="lineno">  518</span>                    <span class="comment"># TLV saved by the bootloader is aligned</span></div>
<div class="line"><span class="lineno">  519</span>                    keylen = (int((enctlv_len - 1) / MAX_ALIGN) + 1) * MAX_ALIGN</div>
<div class="line"><span class="lineno">  520</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  521</span>                    keylen = 16</div>
<div class="line"><span class="lineno">  522</span>                trailer += keylen * 2  <span class="comment"># encryption keys</span></div>
<div class="line"><span class="lineno">  523</span>            trailer += MAX_ALIGN * 4  <span class="comment"># image_ok/copy_done/swap_info/swap_size</span></div>
<div class="line"><span class="lineno">  524</span>            trailer += magic_size</div>
<div class="line"><span class="lineno">  525</span>            <span class="keywordflow">return</span> trailer</div>
<div class="line"><span class="lineno">  526</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5e5f77647e2f4f878f22391acfd89e24" name="a5e5f77647e2f4f878f22391acfd89e24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e5f77647e2f4f878f22391acfd89e24">&#9670;&#160;</a></span>add_header() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">add_header </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>protected_tlv_size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Install the image header.</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00463">463</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  463</span>    <span class="keyword">def </span>add_header(self, enckey, protected_tlv_size):</div>
<div class="line"><span class="lineno">  464</span>        <span class="stringliteral">&quot;&quot;&quot;Install the image header.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>        flags = 0</div>
<div class="line"><span class="lineno">  467</span>        <span class="keywordflow">if</span> enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  468</span>            flags |= IMAGE_F[<span class="stringliteral">&#39;ENCRYPTED&#39;</span>]</div>
<div class="line"><span class="lineno">  469</span>        <span class="keywordflow">if</span> self.load_addr != 0:</div>
<div class="line"><span class="lineno">  470</span>            <span class="comment"># Indicates that this image should be loaded into RAM</span></div>
<div class="line"><span class="lineno">  471</span>            <span class="comment"># instead of run directly from flash.</span></div>
<div class="line"><span class="lineno">  472</span>            flags |= IMAGE_F[<span class="stringliteral">&#39;RAM_LOAD&#39;</span>]</div>
<div class="line"><span class="lineno">  473</span>        <span class="keywordflow">if</span> self.rom_fixed:</div>
<div class="line"><span class="lineno">  474</span>            flags |= IMAGE_F[<span class="stringliteral">&#39;ROM_FIXED&#39;</span>]</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>        e = STRUCT_ENDIAN_DICT[self.endian]</div>
<div class="line"><span class="lineno">  477</span>        fmt = (e +</div>
<div class="line"><span class="lineno">  478</span>               <span class="comment"># type ImageHdr struct {</span></div>
<div class="line"><span class="lineno">  479</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># Magic    uint32</span></div>
<div class="line"><span class="lineno">  480</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># LoadAddr uint32</span></div>
<div class="line"><span class="lineno">  481</span>               <span class="stringliteral">&#39;H&#39;</span> +     <span class="comment"># HdrSz    uint16</span></div>
<div class="line"><span class="lineno">  482</span>               <span class="stringliteral">&#39;H&#39;</span> +     <span class="comment"># PTLVSz   uint16</span></div>
<div class="line"><span class="lineno">  483</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># ImgSz    uint32</span></div>
<div class="line"><span class="lineno">  484</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># Flags    uint32</span></div>
<div class="line"><span class="lineno">  485</span>               <span class="stringliteral">&#39;BBHI&#39;</span> +  <span class="comment"># Vers     ImageVersion</span></div>
<div class="line"><span class="lineno">  486</span>               <span class="stringliteral">&#39;I&#39;</span>       <span class="comment"># Pad1     uint32</span></div>
<div class="line"><span class="lineno">  487</span>               )  <span class="comment"># }</span></div>
<div class="line"><span class="lineno">  488</span>        <span class="keyword">assert</span> struct.calcsize(fmt) == IMAGE_HEADER_SIZE</div>
<div class="line"><span class="lineno">  489</span>        header = struct.pack(fmt,</div>
<div class="line"><span class="lineno">  490</span>                IMAGE_MAGIC,</div>
<div class="line"><span class="lineno">  491</span>                self.rom_fixed <span class="keywordflow">or</span> self.load_addr,</div>
<div class="line"><span class="lineno">  492</span>                self.header_size,</div>
<div class="line"><span class="lineno">  493</span>                protected_tlv_size,  <span class="comment"># TLV Info header + Protected TLVs</span></div>
<div class="line"><span class="lineno">  494</span>                len(self.payload) - self.header_size,  <span class="comment"># ImageSz</span></div>
<div class="line"><span class="lineno">  495</span>                flags,</div>
<div class="line"><span class="lineno">  496</span>                self.version.major,</div>
<div class="line"><span class="lineno">  497</span>                self.version.minor <span class="keywordflow">or</span> 0,</div>
<div class="line"><span class="lineno">  498</span>                self.version.revision <span class="keywordflow">or</span> 0,</div>
<div class="line"><span class="lineno">  499</span>                self.version.build <span class="keywordflow">or</span> 0,</div>
<div class="line"><span class="lineno">  500</span>                0)  <span class="comment"># Pad1</span></div>
<div class="line"><span class="lineno">  501</span>        self.payload = bytearray(self.payload)</div>
<div class="line"><span class="lineno">  502</span>        self.payload[:len(header)] = header</div>
<div class="line"><span class="lineno">  503</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a25e0c88e7d9209d7217d2b63e7b3d48b" name="a25e0c88e7d9209d7217d2b63e7b3d48b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25e0c88e7d9209d7217d2b63e7b3d48b">&#9670;&#160;</a></span>add_header() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">add_header </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>protected_tlv_size</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>aes_length</em><span class="paramdefsep"> = </span><span class="paramdefval">128</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Install the image header.</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00489">489</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  489</span>    <span class="keyword">def </span>add_header(self, enckey, protected_tlv_size, aes_length=128):</div>
<div class="line"><span class="lineno">  490</span>        <span class="stringliteral">&quot;&quot;&quot;Install the image header.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  491</span> </div>
<div class="line"><span class="lineno">  492</span>        flags = 0</div>
<div class="line"><span class="lineno">  493</span>        <span class="keywordflow">if</span> enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  494</span>            <span class="keywordflow">if</span> aes_length == 128:</div>
<div class="line"><span class="lineno">  495</span>                flags |= IMAGE_F[<span class="stringliteral">&#39;ENCRYPTED_AES128&#39;</span>]</div>
<div class="line"><span class="lineno">  496</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  497</span>                flags |= IMAGE_F[<span class="stringliteral">&#39;ENCRYPTED_AES256&#39;</span>]</div>
<div class="line"><span class="lineno">  498</span>        <span class="keywordflow">if</span> self.load_addr != 0:</div>
<div class="line"><span class="lineno">  499</span>            <span class="comment"># Indicates that this image should be loaded into RAM</span></div>
<div class="line"><span class="lineno">  500</span>            <span class="comment"># instead of run directly from flash.</span></div>
<div class="line"><span class="lineno">  501</span>            flags |= IMAGE_F[<span class="stringliteral">&#39;RAM_LOAD&#39;</span>]</div>
<div class="line"><span class="lineno">  502</span>        <span class="keywordflow">if</span> self.rom_fixed:</div>
<div class="line"><span class="lineno">  503</span>            flags |= IMAGE_F[<span class="stringliteral">&#39;ROM_FIXED&#39;</span>]</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>        e = STRUCT_ENDIAN_DICT[self.endian]</div>
<div class="line"><span class="lineno">  506</span>        fmt = (e +</div>
<div class="line"><span class="lineno">  507</span>               <span class="comment"># type ImageHdr struct {</span></div>
<div class="line"><span class="lineno">  508</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># Magic    uint32</span></div>
<div class="line"><span class="lineno">  509</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># LoadAddr uint32</span></div>
<div class="line"><span class="lineno">  510</span>               <span class="stringliteral">&#39;H&#39;</span> +     <span class="comment"># HdrSz    uint16</span></div>
<div class="line"><span class="lineno">  511</span>               <span class="stringliteral">&#39;H&#39;</span> +     <span class="comment"># PTLVSz   uint16</span></div>
<div class="line"><span class="lineno">  512</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># ImgSz    uint32</span></div>
<div class="line"><span class="lineno">  513</span>               <span class="stringliteral">&#39;I&#39;</span> +     <span class="comment"># Flags    uint32</span></div>
<div class="line"><span class="lineno">  514</span>               <span class="stringliteral">&#39;BBHI&#39;</span> +  <span class="comment"># Vers     ImageVersion</span></div>
<div class="line"><span class="lineno">  515</span>               <span class="stringliteral">&#39;I&#39;</span>       <span class="comment"># Pad1     uint32</span></div>
<div class="line"><span class="lineno">  516</span>               )  <span class="comment"># }</span></div>
<div class="line"><span class="lineno">  517</span>        <span class="keyword">assert</span> struct.calcsize(fmt) == IMAGE_HEADER_SIZE</div>
<div class="line"><span class="lineno">  518</span>        header = struct.pack(fmt,</div>
<div class="line"><span class="lineno">  519</span>                IMAGE_MAGIC,</div>
<div class="line"><span class="lineno">  520</span>                self.rom_fixed <span class="keywordflow">or</span> self.load_addr,</div>
<div class="line"><span class="lineno">  521</span>                self.header_size,</div>
<div class="line"><span class="lineno">  522</span>                protected_tlv_size,  <span class="comment"># TLV Info header + Protected TLVs</span></div>
<div class="line"><span class="lineno">  523</span>                len(self.payload) - self.header_size,  <span class="comment"># ImageSz</span></div>
<div class="line"><span class="lineno">  524</span>                flags,</div>
<div class="line"><span class="lineno">  525</span>                self.version.major,</div>
<div class="line"><span class="lineno">  526</span>                self.version.minor <span class="keywordflow">or</span> 0,</div>
<div class="line"><span class="lineno">  527</span>                self.version.revision <span class="keywordflow">or</span> 0,</div>
<div class="line"><span class="lineno">  528</span>                self.version.build <span class="keywordflow">or</span> 0,</div>
<div class="line"><span class="lineno">  529</span>                0)  <span class="comment"># Pad1</span></div>
<div class="line"><span class="lineno">  530</span>        self.payload = bytearray(self.payload)</div>
<div class="line"><span class="lineno">  531</span>        self.payload[:len(header)] = header</div>
<div class="line"><span class="lineno">  532</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c800cde66f3f0bbdf3fe1ef07b292b2" name="a3c800cde66f3f0bbdf3fe1ef07b292b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c800cde66f3f0bbdf3fe1ef07b292b2">&#9670;&#160;</a></span>check_header() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">check_header </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00261">261</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  261</span>    <span class="keyword">def </span>check_header(self):</div>
<div class="line"><span class="lineno">  262</span>        <span class="keywordflow">if</span> self.header_size &gt; 0 <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.pad_header:</div>
<div class="line"><span class="lineno">  263</span>            <span class="keywordflow">if</span> any(v != 0 <span class="keywordflow">for</span> v <span class="keywordflow">in</span> self.payload[0:self.header_size]):</div>
<div class="line"><span class="lineno">  264</span>                <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;Header padding was not requested and &quot;</span></div>
<div class="line"><span class="lineno">  265</span>                                       <span class="stringliteral">&quot;image does not start with zeros&quot;</span>)</div>
<div class="line"><span class="lineno">  266</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c800cde66f3f0bbdf3fe1ef07b292b2" name="a3c800cde66f3f0bbdf3fe1ef07b292b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c800cde66f3f0bbdf3fe1ef07b292b2">&#9670;&#160;</a></span>check_header() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">check_header </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00242">242</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  242</span>    <span class="keyword">def </span>check_header(self):</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">if</span> self.header_size &gt; 0 <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.pad_header:</div>
<div class="line"><span class="lineno">  244</span>            <span class="keywordflow">if</span> any(v != 0 <span class="keywordflow">for</span> v <span class="keywordflow">in</span> self.payload[0:self.header_size]):</div>
<div class="line"><span class="lineno">  245</span>                <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;Header padding was not requested and &quot;</span></div>
<div class="line"><span class="lineno">  246</span>                                       <span class="stringliteral">&quot;image does not start with zeros&quot;</span>)</div>
<div class="line"><span class="lineno">  247</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9e70f9f24dac287273b74b0c7e561aa" name="ac9e70f9f24dac287273b74b0c7e561aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9e70f9f24dac287273b74b0c7e561aa">&#9670;&#160;</a></span>check_trailer() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">check_trailer </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00267">267</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  267</span>    <span class="keyword">def </span>check_trailer(self):</div>
<div class="line"><span class="lineno">  268</span>        <span class="keywordflow">if</span> self.slot_size &gt; 0:</div>
<div class="line"><span class="lineno">  269</span>            tsize = self._trailer_size(self.align, self.max_sectors,</div>
<div class="line"><span class="lineno">  270</span>                                       self.overwrite_only, self.enckey,</div>
<div class="line"><span class="lineno">  271</span>                                       self.save_enctlv, self.enctlv_len)</div>
<div class="line"><span class="lineno">  272</span>            padding = self.slot_size - (len(self.payload) + tsize)</div>
<div class="line"><span class="lineno">  273</span>            <span class="keywordflow">if</span> padding &lt; 0:</div>
<div class="line"><span class="lineno">  274</span>                msg = <span class="stringliteral">&quot;Image size (0x{:x}) + trailer (0x{:x}) exceeds &quot;</span> \</div>
<div class="line"><span class="lineno">  275</span>                      <span class="stringliteral">&quot;requested size 0x{:x}&quot;</span>.format(</div>
<div class="line"><span class="lineno">  276</span>                          len(self.payload), tsize, self.slot_size)</div>
<div class="line"><span class="lineno">  277</span>                <span class="keywordflow">raise</span> click.UsageError(msg)</div>
<div class="line"><span class="lineno">  278</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9e70f9f24dac287273b74b0c7e561aa" name="ac9e70f9f24dac287273b74b0c7e561aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9e70f9f24dac287273b74b0c7e561aa">&#9670;&#160;</a></span>check_trailer() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">check_trailer </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00248">248</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  248</span>    <span class="keyword">def </span>check_trailer(self):</div>
<div class="line"><span class="lineno">  249</span>        <span class="keywordflow">if</span> self.slot_size &gt; 0:</div>
<div class="line"><span class="lineno">  250</span>            tsize = self._trailer_size(self.align, self.max_sectors,</div>
<div class="line"><span class="lineno">  251</span>                                       self.overwrite_only, self.enckey,</div>
<div class="line"><span class="lineno">  252</span>                                       self.save_enctlv, self.enctlv_len)</div>
<div class="line"><span class="lineno">  253</span>            padding = self.slot_size - (len(self.payload) + tsize)</div>
<div class="line"><span class="lineno">  254</span>            <span class="keywordflow">if</span> padding &lt; 0:</div>
<div class="line"><span class="lineno">  255</span>                msg = <span class="stringliteral">&quot;Image size (0x{:x}) + trailer (0x{:x}) exceeds &quot;</span> \</div>
<div class="line"><span class="lineno">  256</span>                      <span class="stringliteral">&quot;requested size 0x{:x}&quot;</span>.format(</div>
<div class="line"><span class="lineno">  257</span>                          len(self.payload), tsize, self.slot_size)</div>
<div class="line"><span class="lineno">  258</span>                <span class="keywordflow">raise</span> click.UsageError(msg)</div>
<div class="line"><span class="lineno">  259</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a155839d5783a4431339f399eaf9eea69" name="a155839d5783a4431339f399eaf9eea69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a155839d5783a4431339f399eaf9eea69">&#9670;&#160;</a></span>create() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">create </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>key</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>public_key_format</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>dependencies</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>sw_type</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>custom_tlvs</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00288">288</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  289</span>               sw_type=<span class="keywordtype">None</span>, custom_tlvs=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  290</span>        self.enckey = enckey</div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>        <span class="comment"># Calculate the hash of the public key</span></div>
<div class="line"><span class="lineno">  293</span>        <span class="keywordflow">if</span> key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  294</span>            pub = key.get_public_bytes()</div>
<div class="line"><span class="lineno">  295</span>            sha = hashlib.sha256()</div>
<div class="line"><span class="lineno">  296</span>            sha.update(pub)</div>
<div class="line"><span class="lineno">  297</span>            pubbytes = sha.digest()</div>
<div class="line"><span class="lineno">  298</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  299</span>            pubbytes = bytes(hashlib.sha256().digest_size)</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>        protected_tlv_size = 0</div>
<div class="line"><span class="lineno">  302</span> </div>
<div class="line"><span class="lineno">  303</span>        <span class="keywordflow">if</span> self.security_counter <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  304</span>            <span class="comment"># Size of the security counter TLV: header (&#39;HH&#39;) + payload (&#39;I&#39;)</span></div>
<div class="line"><span class="lineno">  305</span>            <span class="comment">#                                   = 4 + 4 = 8 Bytes</span></div>
<div class="line"><span class="lineno">  306</span>            protected_tlv_size += TLV_SIZE + 4</div>
<div class="line"><span class="lineno">  307</span> </div>
<div class="line"><span class="lineno">  308</span>        <span class="keywordflow">if</span> sw_type <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  309</span>            <span class="keywordflow">if</span> len(sw_type) &gt; MAX_SW_TYPE_LENGTH:</div>
<div class="line"><span class="lineno">  310</span>                msg = <span class="stringliteral">&quot;&#39;{}&#39; is too long ({} characters) for sw_type. Its &quot;</span> \</div>
<div class="line"><span class="lineno">  311</span>                      <span class="stringliteral">&quot;maximum allowed length is 12 characters.&quot;</span>.format(</div>
<div class="line"><span class="lineno">  312</span>                       sw_type, len(sw_type))</div>
<div class="line"><span class="lineno">  313</span>                <span class="keywordflow">raise</span> click.UsageError(msg)</div>
<div class="line"><span class="lineno">  314</span> </div>
<div class="line"><span class="lineno">  315</span>            image_version = (str(self.version.major) + <span class="stringliteral">&#39;.&#39;</span></div>
<div class="line"><span class="lineno">  316</span>                             + str(self.version.minor) + <span class="stringliteral">&#39;.&#39;</span></div>
<div class="line"><span class="lineno">  317</span>                             + str(self.version.revision))</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>            <span class="comment"># The image hash is computed over the image header, the image</span></div>
<div class="line"><span class="lineno">  320</span>            <span class="comment"># itself and the protected TLV area. However, the boot record TLV</span></div>
<div class="line"><span class="lineno">  321</span>            <span class="comment"># (which is part of the protected area) should contain this hash</span></div>
<div class="line"><span class="lineno">  322</span>            <span class="comment"># before it is even calculated. For this reason the script fills</span></div>
<div class="line"><span class="lineno">  323</span>            <span class="comment"># this field with zeros and the bootloader will insert the right</span></div>
<div class="line"><span class="lineno">  324</span>            <span class="comment"># value later.</span></div>
<div class="line"><span class="lineno">  325</span>            digest = bytes(hashlib.sha256().digest_size)</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>            <span class="comment"># Create CBOR encoded boot record</span></div>
<div class="line"><span class="lineno">  328</span>            boot_record = create_sw_component_data(sw_type, image_version,</div>
<div class="line"><span class="lineno">  329</span>                                                   <span class="stringliteral">&quot;SHA256&quot;</span>, digest,</div>
<div class="line"><span class="lineno">  330</span>                                                   pubbytes)</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>            protected_tlv_size += TLV_SIZE + len(boot_record)</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>        <span class="keywordflow">if</span> dependencies <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  335</span>            <span class="comment"># Size of a Dependency TLV = Header (&#39;HH&#39;) + Payload(&#39;IBBHI&#39;)</span></div>
<div class="line"><span class="lineno">  336</span>            <span class="comment"># = 4 + 12 = 16 Bytes</span></div>
<div class="line"><span class="lineno">  337</span>            dependencies_num = len(dependencies[DEP_IMAGES_KEY])</div>
<div class="line"><span class="lineno">  338</span>            protected_tlv_size += (dependencies_num * 16)</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>        <span class="keywordflow">if</span> custom_tlvs <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  341</span>            <span class="keywordflow">for</span> value <span class="keywordflow">in</span> custom_tlvs.values():</div>
<div class="line"><span class="lineno">  342</span>                protected_tlv_size += TLV_SIZE + len(value)</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>        <span class="keywordflow">if</span> protected_tlv_size != 0:</div>
<div class="line"><span class="lineno">  345</span>            <span class="comment"># Add the size of the TLV info header</span></div>
<div class="line"><span class="lineno">  346</span>            protected_tlv_size += TLV_INFO_SIZE</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>        <span class="comment"># At this point the image is already on the payload</span></div>
<div class="line"><span class="lineno">  349</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  350</span>        <span class="comment"># This adds the padding if image is not aligned to the 16 Bytes</span></div>
<div class="line"><span class="lineno">  351</span>        <span class="comment"># in encrypted mode</span></div>
<div class="line"><span class="lineno">  352</span>        <span class="keywordflow">if</span> self.enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  353</span>            pad_len = len(self.payload) % 16</div>
<div class="line"><span class="lineno">  354</span>            <span class="keywordflow">if</span> pad_len &gt; 0:</div>
<div class="line"><span class="lineno">  355</span>                pad = bytes(16 - pad_len)</div>
<div class="line"><span class="lineno">  356</span>                <span class="keywordflow">if</span> isinstance(self.payload, bytes):</div>
<div class="line"><span class="lineno">  357</span>                    self.payload += pad</div>
<div class="line"><span class="lineno">  358</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  359</span>                    self.payload.extend(pad)</div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>        <span class="comment"># This adds the header to the payload as well</span></div>
<div class="line"><span class="lineno">  362</span>        self.add_header(enckey, protected_tlv_size)</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>        prot_tlv = TLV(self.endian, TLV_PROT_INFO_MAGIC)</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>        <span class="comment"># Protected TLVs must be added first, because they are also included</span></div>
<div class="line"><span class="lineno">  367</span>        <span class="comment"># in the hash calculation</span></div>
<div class="line"><span class="lineno">  368</span>        protected_tlv_off = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  369</span>        <span class="keywordflow">if</span> protected_tlv_size != 0:</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>            e = STRUCT_ENDIAN_DICT[self.endian]</div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>            <span class="keywordflow">if</span> self.security_counter <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  374</span>                payload = struct.pack(e + <span class="stringliteral">&#39;I&#39;</span>, self.security_counter)</div>
<div class="line"><span class="lineno">  375</span>                prot_tlv.add(<span class="stringliteral">&#39;SEC_CNT&#39;</span>, payload)</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>            <span class="keywordflow">if</span> sw_type <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  378</span>                prot_tlv.add(<span class="stringliteral">&#39;BOOT_RECORD&#39;</span>, boot_record)</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>            <span class="keywordflow">if</span> dependencies <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  381</span>                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(dependencies_num):</div>
<div class="line"><span class="lineno">  382</span>                    payload = struct.pack(</div>
<div class="line"><span class="lineno">  383</span>                                    e + <span class="stringliteral">&#39;B3x&#39;</span>+<span class="stringliteral">&#39;BBHI&#39;</span>,</div>
<div class="line"><span class="lineno">  384</span>                                    int(dependencies[DEP_IMAGES_KEY][i]),</div>
<div class="line"><span class="lineno">  385</span>                                    dependencies[DEP_VERSIONS_KEY][i].major,</div>
<div class="line"><span class="lineno">  386</span>                                    dependencies[DEP_VERSIONS_KEY][i].minor,</div>
<div class="line"><span class="lineno">  387</span>                                    dependencies[DEP_VERSIONS_KEY][i].revision,</div>
<div class="line"><span class="lineno">  388</span>                                    dependencies[DEP_VERSIONS_KEY][i].build</div>
<div class="line"><span class="lineno">  389</span>                                    )</div>
<div class="line"><span class="lineno">  390</span>                    prot_tlv.add(<span class="stringliteral">&#39;DEPENDENCY&#39;</span>, payload)</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>            <span class="keywordflow">if</span> custom_tlvs <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  393</span>                <span class="keywordflow">for</span> tag, value <span class="keywordflow">in</span> custom_tlvs.items():</div>
<div class="line"><span class="lineno">  394</span>                    prot_tlv.add(tag, value)</div>
<div class="line"><span class="lineno">  395</span> </div>
<div class="line"><span class="lineno">  396</span>            protected_tlv_off = len(self.payload)</div>
<div class="line"><span class="lineno">  397</span>            self.payload += prot_tlv.get()</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>        tlv = TLV(self.endian)</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>        <span class="comment"># Note that ecdsa wants to do the hashing itself, which means</span></div>
<div class="line"><span class="lineno">  402</span>        <span class="comment"># we get to hash it twice.</span></div>
<div class="line"><span class="lineno">  403</span>        sha = hashlib.sha256()</div>
<div class="line"><span class="lineno">  404</span>        sha.update(self.payload)</div>
<div class="line"><span class="lineno">  405</span>        digest = sha.digest()</div>
<div class="line"><span class="lineno">  406</span> </div>
<div class="line"><span class="lineno">  407</span>        tlv.add(<span class="stringliteral">&#39;SHA256&#39;</span>, digest)</div>
<div class="line"><span class="lineno">  408</span> </div>
<div class="line"><span class="lineno">  409</span>        <span class="keywordflow">if</span> key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  410</span>            <span class="keywordflow">if</span> public_key_format == <span class="stringliteral">&#39;hash&#39;</span>:</div>
<div class="line"><span class="lineno">  411</span>                tlv.add(<span class="stringliteral">&#39;KEYHASH&#39;</span>, pubbytes)</div>
<div class="line"><span class="lineno">  412</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  413</span>                tlv.add(<span class="stringliteral">&#39;PUBKEY&#39;</span>, pub)</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>            <span class="comment"># `sign` expects the full image payload (sha256 done internally),</span></div>
<div class="line"><span class="lineno">  416</span>            <span class="comment"># while `sign_digest` expects only the digest of the payload</span></div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>            <span class="keywordflow">if</span> hasattr(key, <span class="stringliteral">&#39;sign&#39;</span>):</div>
<div class="line"><span class="lineno">  419</span>                sig = key.sign(bytes(self.payload))</div>
<div class="line"><span class="lineno">  420</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  421</span>                sig = key.sign_digest(digest)</div>
<div class="line"><span class="lineno">  422</span>            tlv.add(key.sig_tlv(), sig)</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>        <span class="comment"># At this point the image was hashed + signed, we can remove the</span></div>
<div class="line"><span class="lineno">  425</span>        <span class="comment"># protected TLVs from the payload (will be re-added later)</span></div>
<div class="line"><span class="lineno">  426</span>        <span class="keywordflow">if</span> protected_tlv_off <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  427</span>            self.payload = self.payload[:protected_tlv_off]</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>        <span class="keywordflow">if</span> enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  430</span>            plainkey = os.urandom(16)</div>
<div class="line"><span class="lineno">  431</span> </div>
<div class="line"><span class="lineno">  432</span>            <span class="keywordflow">if</span> isinstance(enckey, rsa.RSAPublic):</div>
<div class="line"><span class="lineno">  433</span>                cipherkey = enckey._get_public().encrypt(</div>
<div class="line"><span class="lineno">  434</span>                    plainkey, padding.OAEP(</div>
<div class="line"><span class="lineno">  435</span>                        mgf=padding.MGF1(algorithm=hashes.SHA256()),</div>
<div class="line"><span class="lineno">  436</span>                        algorithm=hashes.SHA256(),</div>
<div class="line"><span class="lineno">  437</span>                        label=<span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno">  438</span>                self.enctlv_len = len(cipherkey)</div>
<div class="line"><span class="lineno">  439</span>                tlv.add(<span class="stringliteral">&#39;ENCRSA2048&#39;</span>, cipherkey)</div>
<div class="line"><span class="lineno">  440</span>            <span class="keywordflow">elif</span> isinstance(enckey, (ecdsa.ECDSA256P1Public,</div>
<div class="line"><span class="lineno">  441</span>                                     x25519.X25519Public)):</div>
<div class="line"><span class="lineno">  442</span>                cipherkey, mac, pubk = self.ecies_hkdf(enckey, plainkey)</div>
<div class="line"><span class="lineno">  443</span>                enctlv = pubk + mac + cipherkey</div>
<div class="line"><span class="lineno">  444</span>                self.enctlv_len = len(enctlv)</div>
<div class="line"><span class="lineno">  445</span>                <span class="keywordflow">if</span> isinstance(enckey, ecdsa.ECDSA256P1Public):</div>
<div class="line"><span class="lineno">  446</span>                    tlv.add(<span class="stringliteral">&#39;ENCEC256&#39;</span>, enctlv)</div>
<div class="line"><span class="lineno">  447</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  448</span>                    tlv.add(<span class="stringliteral">&#39;ENCX25519&#39;</span>, enctlv)</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>            nonce = bytes([0] * 16)</div>
<div class="line"><span class="lineno">  451</span>            cipher = Cipher(algorithms.AES(plainkey), modes.CTR(nonce),</div>
<div class="line"><span class="lineno">  452</span>                            backend=default_backend())</div>
<div class="line"><span class="lineno">  453</span>            encryptor = cipher.encryptor()</div>
<div class="line"><span class="lineno">  454</span>            img = bytes(self.payload[self.header_size:])</div>
<div class="line"><span class="lineno">  455</span>            self.payload[self.header_size:] = \</div>
<div class="line"><span class="lineno">  456</span>                encryptor.update(img) + encryptor.finalize()</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>        self.payload += prot_tlv.get()</div>
<div class="line"><span class="lineno">  459</span>        self.payload += tlv.get()</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>        self.check_trailer()</div>
<div class="line"><span class="lineno">  462</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a5f7227fab39547130f389b75907f1d" name="a3a5f7227fab39547130f389b75907f1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a5f7227fab39547130f389b75907f1d">&#9670;&#160;</a></span>create() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">create </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>key</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>public_key_format</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>dependencies</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>sw_type</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>custom_tlvs</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>encrypt_keylen</em><span class="paramdefsep"> = </span><span class="paramdefval">128</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>clear</em><span class="paramdefsep"> = </span><span class="paramdefval">False</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00307">307</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  308</span>               sw_type=<span class="keywordtype">None</span>, custom_tlvs=<span class="keywordtype">None</span>, encrypt_keylen=128, clear=<span class="keyword">False</span>):</div>
<div class="line"><span class="lineno">  309</span>        self.enckey = enckey</div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span>        <span class="comment"># Calculate the hash of the public key</span></div>
<div class="line"><span class="lineno">  312</span>        <span class="keywordflow">if</span> key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  313</span>            pub = key.get_public_bytes()</div>
<div class="line"><span class="lineno">  314</span>            sha = hashlib.sha256()</div>
<div class="line"><span class="lineno">  315</span>            sha.update(pub)</div>
<div class="line"><span class="lineno">  316</span>            pubbytes = sha.digest()</div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  318</span>            pubbytes = bytes(hashlib.sha256().digest_size)</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>        protected_tlv_size = 0</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>        <span class="keywordflow">if</span> self.security_counter <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  323</span>            <span class="comment"># Size of the security counter TLV: header (&#39;HH&#39;) + payload (&#39;I&#39;)</span></div>
<div class="line"><span class="lineno">  324</span>            <span class="comment">#                                   = 4 + 4 = 8 Bytes</span></div>
<div class="line"><span class="lineno">  325</span>            protected_tlv_size += TLV_SIZE + 4</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>        <span class="keywordflow">if</span> sw_type <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  328</span>            <span class="keywordflow">if</span> len(sw_type) &gt; MAX_SW_TYPE_LENGTH:</div>
<div class="line"><span class="lineno">  329</span>                msg = <span class="stringliteral">&quot;&#39;{}&#39; is too long ({} characters) for sw_type. Its &quot;</span> \</div>
<div class="line"><span class="lineno">  330</span>                      <span class="stringliteral">&quot;maximum allowed length is 12 characters.&quot;</span>.format(</div>
<div class="line"><span class="lineno">  331</span>                       sw_type, len(sw_type))</div>
<div class="line"><span class="lineno">  332</span>                <span class="keywordflow">raise</span> click.UsageError(msg)</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>            image_version = (str(self.version.major) + <span class="stringliteral">&#39;.&#39;</span></div>
<div class="line"><span class="lineno">  335</span>                             + str(self.version.minor) + <span class="stringliteral">&#39;.&#39;</span></div>
<div class="line"><span class="lineno">  336</span>                             + str(self.version.revision))</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span>            <span class="comment"># The image hash is computed over the image header, the image</span></div>
<div class="line"><span class="lineno">  339</span>            <span class="comment"># itself and the protected TLV area. However, the boot record TLV</span></div>
<div class="line"><span class="lineno">  340</span>            <span class="comment"># (which is part of the protected area) should contain this hash</span></div>
<div class="line"><span class="lineno">  341</span>            <span class="comment"># before it is even calculated. For this reason the script fills</span></div>
<div class="line"><span class="lineno">  342</span>            <span class="comment"># this field with zeros and the bootloader will insert the right</span></div>
<div class="line"><span class="lineno">  343</span>            <span class="comment"># value later.</span></div>
<div class="line"><span class="lineno">  344</span>            digest = bytes(hashlib.sha256().digest_size)</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>            <span class="comment"># Create CBOR encoded boot record</span></div>
<div class="line"><span class="lineno">  347</span>            boot_record = create_sw_component_data(sw_type, image_version,</div>
<div class="line"><span class="lineno">  348</span>                                                   <span class="stringliteral">&quot;SHA256&quot;</span>, digest,</div>
<div class="line"><span class="lineno">  349</span>                                                   pubbytes)</div>
<div class="line"><span class="lineno">  350</span> </div>
<div class="line"><span class="lineno">  351</span>            protected_tlv_size += TLV_SIZE + len(boot_record)</div>
<div class="line"><span class="lineno">  352</span> </div>
<div class="line"><span class="lineno">  353</span>        <span class="keywordflow">if</span> dependencies <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  354</span>            <span class="comment"># Size of a Dependency TLV = Header (&#39;HH&#39;) + Payload(&#39;IBBHI&#39;)</span></div>
<div class="line"><span class="lineno">  355</span>            <span class="comment"># = 4 + 12 = 16 Bytes</span></div>
<div class="line"><span class="lineno">  356</span>            dependencies_num = len(dependencies[DEP_IMAGES_KEY])</div>
<div class="line"><span class="lineno">  357</span>            protected_tlv_size += (dependencies_num * 16)</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>        <span class="keywordflow">if</span> custom_tlvs <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  360</span>            <span class="keywordflow">for</span> value <span class="keywordflow">in</span> custom_tlvs.values():</div>
<div class="line"><span class="lineno">  361</span>                protected_tlv_size += TLV_SIZE + len(value)</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>        <span class="keywordflow">if</span> protected_tlv_size != 0:</div>
<div class="line"><span class="lineno">  364</span>            <span class="comment"># Add the size of the TLV info header</span></div>
<div class="line"><span class="lineno">  365</span>            protected_tlv_size += TLV_INFO_SIZE</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>        <span class="comment"># At this point the image is already on the payload</span></div>
<div class="line"><span class="lineno">  368</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  369</span>        <span class="comment"># This adds the padding if image is not aligned to the 16 Bytes</span></div>
<div class="line"><span class="lineno">  370</span>        <span class="comment"># in encrypted mode</span></div>
<div class="line"><span class="lineno">  371</span>        <span class="keywordflow">if</span> self.enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  372</span>            pad_len = len(self.payload) % 16</div>
<div class="line"><span class="lineno">  373</span>            <span class="keywordflow">if</span> pad_len &gt; 0:</div>
<div class="line"><span class="lineno">  374</span>                pad = bytes(16 - pad_len)</div>
<div class="line"><span class="lineno">  375</span>                <span class="keywordflow">if</span> isinstance(self.payload, bytes):</div>
<div class="line"><span class="lineno">  376</span>                    self.payload += pad</div>
<div class="line"><span class="lineno">  377</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  378</span>                    self.payload.extend(pad)</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>        <span class="comment"># This adds the header to the payload as well</span></div>
<div class="line"><span class="lineno">  381</span>        <span class="keywordflow">if</span> encrypt_keylen == 256:</div>
<div class="line"><span class="lineno">  382</span>            self.add_header(enckey, protected_tlv_size, 256)</div>
<div class="line"><span class="lineno">  383</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  384</span>            self.add_header(enckey, protected_tlv_size)</div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>        prot_tlv = TLV(self.endian, TLV_PROT_INFO_MAGIC)</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>        <span class="comment"># Protected TLVs must be added first, because they are also included</span></div>
<div class="line"><span class="lineno">  389</span>        <span class="comment"># in the hash calculation</span></div>
<div class="line"><span class="lineno">  390</span>        protected_tlv_off = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordflow">if</span> protected_tlv_size != 0:</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span>            e = STRUCT_ENDIAN_DICT[self.endian]</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>            <span class="keywordflow">if</span> self.security_counter <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  396</span>                payload = struct.pack(e + <span class="stringliteral">&#39;I&#39;</span>, self.security_counter)</div>
<div class="line"><span class="lineno">  397</span>                prot_tlv.add(<span class="stringliteral">&#39;SEC_CNT&#39;</span>, payload)</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>            <span class="keywordflow">if</span> sw_type <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  400</span>                prot_tlv.add(<span class="stringliteral">&#39;BOOT_RECORD&#39;</span>, boot_record)</div>
<div class="line"><span class="lineno">  401</span> </div>
<div class="line"><span class="lineno">  402</span>            <span class="keywordflow">if</span> dependencies <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  403</span>                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(dependencies_num):</div>
<div class="line"><span class="lineno">  404</span>                    payload = struct.pack(</div>
<div class="line"><span class="lineno">  405</span>                                    e + <span class="stringliteral">&#39;B3x&#39;</span>+<span class="stringliteral">&#39;BBHI&#39;</span>,</div>
<div class="line"><span class="lineno">  406</span>                                    int(dependencies[DEP_IMAGES_KEY][i]),</div>
<div class="line"><span class="lineno">  407</span>                                    dependencies[DEP_VERSIONS_KEY][i].major,</div>
<div class="line"><span class="lineno">  408</span>                                    dependencies[DEP_VERSIONS_KEY][i].minor,</div>
<div class="line"><span class="lineno">  409</span>                                    dependencies[DEP_VERSIONS_KEY][i].revision,</div>
<div class="line"><span class="lineno">  410</span>                                    dependencies[DEP_VERSIONS_KEY][i].build</div>
<div class="line"><span class="lineno">  411</span>                                    )</div>
<div class="line"><span class="lineno">  412</span>                    prot_tlv.add(<span class="stringliteral">&#39;DEPENDENCY&#39;</span>, payload)</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span>            <span class="keywordflow">if</span> custom_tlvs <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  415</span>                <span class="keywordflow">for</span> tag, value <span class="keywordflow">in</span> custom_tlvs.items():</div>
<div class="line"><span class="lineno">  416</span>                    prot_tlv.add(tag, value)</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>            protected_tlv_off = len(self.payload)</div>
<div class="line"><span class="lineno">  419</span>            self.payload += prot_tlv.get()</div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>        tlv = TLV(self.endian)</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>        <span class="comment"># Note that ecdsa wants to do the hashing itself, which means</span></div>
<div class="line"><span class="lineno">  424</span>        <span class="comment"># we get to hash it twice.</span></div>
<div class="line"><span class="lineno">  425</span>        sha = hashlib.sha256()</div>
<div class="line"><span class="lineno">  426</span>        sha.update(self.payload)</div>
<div class="line"><span class="lineno">  427</span>        digest = sha.digest()</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>        tlv.add(<span class="stringliteral">&#39;SHA256&#39;</span>, digest)</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>        <span class="keywordflow">if</span> key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  432</span>            <span class="keywordflow">if</span> public_key_format == <span class="stringliteral">&#39;hash&#39;</span>:</div>
<div class="line"><span class="lineno">  433</span>                tlv.add(<span class="stringliteral">&#39;KEYHASH&#39;</span>, pubbytes)</div>
<div class="line"><span class="lineno">  434</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  435</span>                tlv.add(<span class="stringliteral">&#39;PUBKEY&#39;</span>, pub)</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>            <span class="comment"># `sign` expects the full image payload (sha256 done internally),</span></div>
<div class="line"><span class="lineno">  438</span>            <span class="comment"># while `sign_digest` expects only the digest of the payload</span></div>
<div class="line"><span class="lineno">  439</span> </div>
<div class="line"><span class="lineno">  440</span>            <span class="keywordflow">if</span> hasattr(key, <span class="stringliteral">&#39;sign&#39;</span>):</div>
<div class="line"><span class="lineno">  441</span>                sig = key.sign(bytes(self.payload))</div>
<div class="line"><span class="lineno">  442</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  443</span>                sig = key.sign_digest(digest)</div>
<div class="line"><span class="lineno">  444</span>            tlv.add(key.sig_tlv(), sig)</div>
<div class="line"><span class="lineno">  445</span> </div>
<div class="line"><span class="lineno">  446</span>        <span class="comment"># At this point the image was hashed + signed, we can remove the</span></div>
<div class="line"><span class="lineno">  447</span>        <span class="comment"># protected TLVs from the payload (will be re-added later)</span></div>
<div class="line"><span class="lineno">  448</span>        <span class="keywordflow">if</span> protected_tlv_off <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  449</span>            self.payload = self.payload[:protected_tlv_off]</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>        <span class="keywordflow">if</span> enckey <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  452</span>            <span class="keywordflow">if</span> encrypt_keylen == 256:</div>
<div class="line"><span class="lineno">  453</span>                plainkey = os.urandom(32)</div>
<div class="line"><span class="lineno">  454</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  455</span>                plainkey = os.urandom(16)</div>
<div class="line"><span class="lineno">  456</span> </div>
<div class="line"><span class="lineno">  457</span>            <span class="keywordflow">if</span> isinstance(enckey, rsa.RSAPublic):</div>
<div class="line"><span class="lineno">  458</span>                cipherkey = enckey._get_public().encrypt(</div>
<div class="line"><span class="lineno">  459</span>                    plainkey, padding.OAEP(</div>
<div class="line"><span class="lineno">  460</span>                        mgf=padding.MGF1(algorithm=hashes.SHA256()),</div>
<div class="line"><span class="lineno">  461</span>                        algorithm=hashes.SHA256(),</div>
<div class="line"><span class="lineno">  462</span>                        label=<span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno">  463</span>                self.enctlv_len = len(cipherkey)</div>
<div class="line"><span class="lineno">  464</span>                tlv.add(<span class="stringliteral">&#39;ENCRSA2048&#39;</span>, cipherkey)</div>
<div class="line"><span class="lineno">  465</span>            <span class="keywordflow">elif</span> isinstance(enckey, (ecdsa.ECDSA256P1Public,</div>
<div class="line"><span class="lineno">  466</span>                                     x25519.X25519Public)):</div>
<div class="line"><span class="lineno">  467</span>                cipherkey, mac, pubk = self.ecies_hkdf(enckey, plainkey)</div>
<div class="line"><span class="lineno">  468</span>                enctlv = pubk + mac + cipherkey</div>
<div class="line"><span class="lineno">  469</span>                self.enctlv_len = len(enctlv)</div>
<div class="line"><span class="lineno">  470</span>                <span class="keywordflow">if</span> isinstance(enckey, ecdsa.ECDSA256P1Public):</div>
<div class="line"><span class="lineno">  471</span>                    tlv.add(<span class="stringliteral">&#39;ENCEC256&#39;</span>, enctlv)</div>
<div class="line"><span class="lineno">  472</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  473</span>                    tlv.add(<span class="stringliteral">&#39;ENCX25519&#39;</span>, enctlv)</div>
<div class="line"><span class="lineno">  474</span> </div>
<div class="line"><span class="lineno">  475</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> clear:</div>
<div class="line"><span class="lineno">  476</span>                nonce = bytes([0] * 16)</div>
<div class="line"><span class="lineno">  477</span>                cipher = Cipher(algorithms.AES(plainkey), modes.CTR(nonce),</div>
<div class="line"><span class="lineno">  478</span>                                backend=default_backend())</div>
<div class="line"><span class="lineno">  479</span>                encryptor = cipher.encryptor()</div>
<div class="line"><span class="lineno">  480</span>                img = bytes(self.payload[self.header_size:])</div>
<div class="line"><span class="lineno">  481</span>                self.payload[self.header_size:] = \</div>
<div class="line"><span class="lineno">  482</span>                    encryptor.update(img) + encryptor.finalize()</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>        self.payload += prot_tlv.get()</div>
<div class="line"><span class="lineno">  485</span>        self.payload += tlv.get()</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>        self.check_trailer()</div>
<div class="line"><span class="lineno">  488</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f6923ecc13ffce53c3d1179e8704f6c" name="a1f6923ecc13ffce53c3d1179e8704f6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6923ecc13ffce53c3d1179e8704f6c">&#9670;&#160;</a></span>ecies_hkdf() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ecies_hkdf </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>plainkey</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00279">279</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  279</span>    <span class="keyword">def </span>ecies_hkdf(self, enckey, plainkey):</div>
<div class="line"><span class="lineno">  280</span>        <span class="keywordflow">if</span> isinstance(enckey, ecdsa.ECDSA256P1Public):</div>
<div class="line"><span class="lineno">  281</span>            newpk = ec.generate_private_key(ec.SECP256R1(), default_backend())</div>
<div class="line"><span class="lineno">  282</span>            shared = newpk.exchange(ec.ECDH(), enckey._get_public())</div>
<div class="line"><span class="lineno">  283</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  284</span>            newpk = X25519PrivateKey.generate()</div>
<div class="line"><span class="lineno">  285</span>            shared = newpk.exchange(enckey._get_public())</div>
<div class="line"><span class="lineno">  286</span>        derived_key = HKDF(</div>
<div class="line"><span class="lineno">  287</span>            algorithm=hashes.SHA256(), length=48, salt=<span class="keywordtype">None</span>,</div>
<div class="line"><span class="lineno">  288</span>            info=b<span class="stringliteral">&#39;MCUBoot_ECIES_v1&#39;</span>, backend=default_backend()).derive(shared)</div>
<div class="line"><span class="lineno">  289</span>        encryptor = Cipher(algorithms.AES(derived_key[:16]),</div>
<div class="line"><span class="lineno">  290</span>                           modes.CTR(bytes([0] * 16)),</div>
<div class="line"><span class="lineno">  291</span>                           backend=default_backend()).encryptor()</div>
<div class="line"><span class="lineno">  292</span>        cipherkey = encryptor.update(plainkey) + encryptor.finalize()</div>
<div class="line"><span class="lineno">  293</span>        mac = hmac.HMAC(derived_key[16:], hashes.SHA256(),</div>
<div class="line"><span class="lineno">  294</span>                        backend=default_backend())</div>
<div class="line"><span class="lineno">  295</span>        mac.update(cipherkey)</div>
<div class="line"><span class="lineno">  296</span>        ciphermac = mac.finalize()</div>
<div class="line"><span class="lineno">  297</span>        <span class="keywordflow">if</span> isinstance(enckey, ecdsa.ECDSA256P1Public):</div>
<div class="line"><span class="lineno">  298</span>            pubk = newpk.public_key().public_bytes(</div>
<div class="line"><span class="lineno">  299</span>                encoding=Encoding.X962,</div>
<div class="line"><span class="lineno">  300</span>                format=PublicFormat.UncompressedPoint)</div>
<div class="line"><span class="lineno">  301</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  302</span>            pubk = newpk.public_key().public_bytes(</div>
<div class="line"><span class="lineno">  303</span>                encoding=Encoding.Raw,</div>
<div class="line"><span class="lineno">  304</span>                format=PublicFormat.Raw)</div>
<div class="line"><span class="lineno">  305</span>        <span class="keywordflow">return</span> cipherkey, ciphermac, pubk</div>
<div class="line"><span class="lineno">  306</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f6923ecc13ffce53c3d1179e8704f6c" name="a1f6923ecc13ffce53c3d1179e8704f6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6923ecc13ffce53c3d1179e8704f6c">&#9670;&#160;</a></span>ecies_hkdf() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ecies_hkdf </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>enckey</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>plainkey</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00260">260</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  260</span>    <span class="keyword">def </span>ecies_hkdf(self, enckey, plainkey):</div>
<div class="line"><span class="lineno">  261</span>        <span class="keywordflow">if</span> isinstance(enckey, ecdsa.ECDSA256P1Public):</div>
<div class="line"><span class="lineno">  262</span>            newpk = ec.generate_private_key(ec.SECP256R1(), default_backend())</div>
<div class="line"><span class="lineno">  263</span>            shared = newpk.exchange(ec.ECDH(), enckey._get_public())</div>
<div class="line"><span class="lineno">  264</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  265</span>            newpk = X25519PrivateKey.generate()</div>
<div class="line"><span class="lineno">  266</span>            shared = newpk.exchange(enckey._get_public())</div>
<div class="line"><span class="lineno">  267</span>        derived_key = HKDF(</div>
<div class="line"><span class="lineno">  268</span>            algorithm=hashes.SHA256(), length=48, salt=<span class="keywordtype">None</span>,</div>
<div class="line"><span class="lineno">  269</span>            info=b<span class="stringliteral">&#39;MCUBoot_ECIES_v1&#39;</span>, backend=default_backend()).derive(shared)</div>
<div class="line"><span class="lineno">  270</span>        encryptor = Cipher(algorithms.AES(derived_key[:16]),</div>
<div class="line"><span class="lineno">  271</span>                           modes.CTR(bytes([0] * 16)),</div>
<div class="line"><span class="lineno">  272</span>                           backend=default_backend()).encryptor()</div>
<div class="line"><span class="lineno">  273</span>        cipherkey = encryptor.update(plainkey) + encryptor.finalize()</div>
<div class="line"><span class="lineno">  274</span>        mac = hmac.HMAC(derived_key[16:], hashes.SHA256(),</div>
<div class="line"><span class="lineno">  275</span>                        backend=default_backend())</div>
<div class="line"><span class="lineno">  276</span>        mac.update(cipherkey)</div>
<div class="line"><span class="lineno">  277</span>        ciphermac = mac.finalize()</div>
<div class="line"><span class="lineno">  278</span>        <span class="keywordflow">if</span> isinstance(enckey, ecdsa.ECDSA256P1Public):</div>
<div class="line"><span class="lineno">  279</span>            pubk = newpk.public_key().public_bytes(</div>
<div class="line"><span class="lineno">  280</span>                encoding=Encoding.X962,</div>
<div class="line"><span class="lineno">  281</span>                format=PublicFormat.UncompressedPoint)</div>
<div class="line"><span class="lineno">  282</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  283</span>            pubk = newpk.public_key().public_bytes(</div>
<div class="line"><span class="lineno">  284</span>                encoding=Encoding.Raw,</div>
<div class="line"><span class="lineno">  285</span>                format=PublicFormat.Raw)</div>
<div class="line"><span class="lineno">  286</span>        <span class="keywordflow">return</span> cipherkey, ciphermac, pubk</div>
<div class="line"><span class="lineno">  287</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aae9853a9699155c034c6dd57551bcca4" name="aae9853a9699155c034c6dd57551bcca4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae9853a9699155c034c6dd57551bcca4">&#9670;&#160;</a></span>load() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">load </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Load an image from a given file</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00202">202</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  202</span>    <span class="keyword">def </span>load(self, path):</div>
<div class="line"><span class="lineno">  203</span>        <span class="stringliteral">&quot;&quot;&quot;Load an image from a given file&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  204</span>        ext = os.path.splitext(path)[1][1:].lower()</div>
<div class="line"><span class="lineno">  205</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  206</span>            <span class="keywordflow">if</span> ext == INTEL_HEX_EXT:</div>
<div class="line"><span class="lineno">  207</span>                ih = IntelHex(path)</div>
<div class="line"><span class="lineno">  208</span>                self.payload = ih.tobinarray()</div>
<div class="line"><span class="lineno">  209</span>                self.base_addr = ih.minaddr()</div>
<div class="line"><span class="lineno">  210</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  211</span>                <span class="keyword">with</span> open(path, <span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  212</span>                    self.payload = f.read()</div>
<div class="line"><span class="lineno">  213</span>        <span class="keywordflow">except</span> FileNotFoundError:</div>
<div class="line"><span class="lineno">  214</span>            <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;Input file not found&quot;</span>)</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>        <span class="comment"># Add the image header if needed.</span></div>
<div class="line"><span class="lineno">  217</span>        <span class="keywordflow">if</span> self.pad_header <span class="keywordflow">and</span> self.header_size &gt; 0:</div>
<div class="line"><span class="lineno">  218</span>            <span class="keywordflow">if</span> self.base_addr:</div>
<div class="line"><span class="lineno">  219</span>                <span class="comment"># Adjust base_addr for new header</span></div>
<div class="line"><span class="lineno">  220</span>                self.base_addr -= self.header_size</div>
<div class="line"><span class="lineno">  221</span>            self.payload = bytes([self.erased_val] * self.header_size) + \</div>
<div class="line"><span class="lineno">  222</span>                self.payload</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>        self.check_header()</div>
<div class="line"><span class="lineno">  225</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aae9853a9699155c034c6dd57551bcca4" name="aae9853a9699155c034c6dd57551bcca4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae9853a9699155c034c6dd57551bcca4">&#9670;&#160;</a></span>load() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">load </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Load an image from a given file</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00186">186</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  186</span>    <span class="keyword">def </span>load(self, path):</div>
<div class="line"><span class="lineno">  187</span>        <span class="stringliteral">&quot;&quot;&quot;Load an image from a given file&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  188</span>        ext = os.path.splitext(path)[1][1:].lower()</div>
<div class="line"><span class="lineno">  189</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  190</span>            <span class="keywordflow">if</span> ext == INTEL_HEX_EXT:</div>
<div class="line"><span class="lineno">  191</span>                ih = IntelHex(path)</div>
<div class="line"><span class="lineno">  192</span>                self.payload = ih.tobinarray()</div>
<div class="line"><span class="lineno">  193</span>                self.base_addr = ih.minaddr()</div>
<div class="line"><span class="lineno">  194</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  195</span>                <span class="keyword">with</span> open(path, <span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  196</span>                    self.payload = f.read()</div>
<div class="line"><span class="lineno">  197</span>        <span class="keywordflow">except</span> FileNotFoundError:</div>
<div class="line"><span class="lineno">  198</span>            <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;Input file not found&quot;</span>)</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>        <span class="comment"># Add the image header if needed.</span></div>
<div class="line"><span class="lineno">  201</span>        <span class="keywordflow">if</span> self.pad_header <span class="keywordflow">and</span> self.header_size &gt; 0:</div>
<div class="line"><span class="lineno">  202</span>            <span class="keywordflow">if</span> self.base_addr:</div>
<div class="line"><span class="lineno">  203</span>                <span class="comment"># Adjust base_addr for new header</span></div>
<div class="line"><span class="lineno">  204</span>                self.base_addr -= self.header_size</div>
<div class="line"><span class="lineno">  205</span>            self.payload = bytes([self.erased_val] * self.header_size) + \</div>
<div class="line"><span class="lineno">  206</span>                self.payload</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>        self.check_header()</div>
<div class="line"><span class="lineno">  209</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a02d90e9f0f17d4fb607d4741af0483ca" name="a02d90e9f0f17d4fb607d4741af0483ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02d90e9f0f17d4fb607d4741af0483ca">&#9670;&#160;</a></span>pad_to() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pad_to </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Pad the image to the given size, with the given flash alignment.</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00557">557</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  557</span>    <span class="keyword">def </span>pad_to(self, size):</div>
<div class="line"><span class="lineno">  558</span>        <span class="stringliteral">&quot;&quot;&quot;Pad the image to the given size, with the given flash alignment.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  559</span>        tsize = self._trailer_size(self.align, self.max_sectors,</div>
<div class="line"><span class="lineno">  560</span>                                   self.overwrite_only, self.enckey,</div>
<div class="line"><span class="lineno">  561</span>                                   self.save_enctlv, self.enctlv_len)</div>
<div class="line"><span class="lineno">  562</span>        padding = size - (len(self.payload) + tsize)</div>
<div class="line"><span class="lineno">  563</span>        pbytes = bytearray([self.erased_val] * padding)</div>
<div class="line"><span class="lineno">  564</span>        pbytes += bytearray([self.erased_val] * (tsize - len(self.boot_magic)))</div>
<div class="line"><span class="lineno">  565</span>        pbytes += self.boot_magic</div>
<div class="line"><span class="lineno">  566</span>        <span class="keywordflow">if</span> self.confirm <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.overwrite_only:</div>
<div class="line"><span class="lineno">  567</span>            magic_size = 16</div>
<div class="line"><span class="lineno">  568</span>            magic_align_size = align_up(magic_size, self.max_align)</div>
<div class="line"><span class="lineno">  569</span>            image_ok_idx = -(magic_align_size + self.max_align)</div>
<div class="line"><span class="lineno">  570</span>            pbytes[image_ok_idx] = 0x01  <span class="comment"># image_ok = 0x01</span></div>
<div class="line"><span class="lineno">  571</span>        self.payload += pbytes</div>
<div class="line"><span class="lineno">  572</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a02d90e9f0f17d4fb607d4741af0483ca" name="a02d90e9f0f17d4fb607d4741af0483ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02d90e9f0f17d4fb607d4741af0483ca">&#9670;&#160;</a></span>pad_to() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pad_to </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Pad the image to the given size, with the given flash alignment.</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00527">527</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  527</span>    <span class="keyword">def </span>pad_to(self, size):</div>
<div class="line"><span class="lineno">  528</span>        <span class="stringliteral">&quot;&quot;&quot;Pad the image to the given size, with the given flash alignment.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  529</span>        tsize = self._trailer_size(self.align, self.max_sectors,</div>
<div class="line"><span class="lineno">  530</span>                                   self.overwrite_only, self.enckey,</div>
<div class="line"><span class="lineno">  531</span>                                   self.save_enctlv, self.enctlv_len)</div>
<div class="line"><span class="lineno">  532</span>        padding = size - (len(self.payload) + tsize)</div>
<div class="line"><span class="lineno">  533</span>        pbytes = bytearray([self.erased_val] * padding)</div>
<div class="line"><span class="lineno">  534</span>        pbytes += bytearray([self.erased_val] * (tsize - len(boot_magic)))</div>
<div class="line"><span class="lineno">  535</span>        <span class="keywordflow">if</span> self.confirm <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.overwrite_only:</div>
<div class="line"><span class="lineno">  536</span>            pbytes[-MAX_ALIGN] = 0x01  <span class="comment"># image_ok = 0x01</span></div>
<div class="line"><span class="lineno">  537</span>        pbytes += boot_magic</div>
<div class="line"><span class="lineno">  538</span>        self.payload += pbytes</div>
<div class="line"><span class="lineno">  539</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a2dfc4f3822963e9ea5dc5d02509a6ac7" name="a2dfc4f3822963e9ea5dc5d02509a6ac7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dfc4f3822963e9ea5dc5d02509a6ac7">&#9670;&#160;</a></span>save() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">save </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>hex_addr</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Save an image from a given file</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00226">226</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  226</span>    <span class="keyword">def </span>save(self, path, hex_addr=None):</div>
<div class="line"><span class="lineno">  227</span>        <span class="stringliteral">&quot;&quot;&quot;Save an image from a given file&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  228</span>        ext = os.path.splitext(path)[1][1:].lower()</div>
<div class="line"><span class="lineno">  229</span>        <span class="keywordflow">if</span> ext == INTEL_HEX_EXT:</div>
<div class="line"><span class="lineno">  230</span>            <span class="comment"># input was in binary format, but HEX needs to know the base addr</span></div>
<div class="line"><span class="lineno">  231</span>            <span class="keywordflow">if</span> self.base_addr <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> hex_addr <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  232</span>                <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;No address exists in input file &quot;</span></div>
<div class="line"><span class="lineno">  233</span>                                       <span class="stringliteral">&quot;neither was it provided by user&quot;</span>)</div>
<div class="line"><span class="lineno">  234</span>            h = IntelHex()</div>
<div class="line"><span class="lineno">  235</span>            <span class="keywordflow">if</span> hex_addr <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  236</span>                self.base_addr = hex_addr</div>
<div class="line"><span class="lineno">  237</span>            h.frombytes(bytes=self.payload, offset=self.base_addr)</div>
<div class="line"><span class="lineno">  238</span>            <span class="keywordflow">if</span> self.pad:</div>
<div class="line"><span class="lineno">  239</span>                trailer_size = self._trailer_size(self.align, self.max_sectors,</div>
<div class="line"><span class="lineno">  240</span>                                                  self.overwrite_only,</div>
<div class="line"><span class="lineno">  241</span>                                                  self.enckey,</div>
<div class="line"><span class="lineno">  242</span>                                                  self.save_enctlv,</div>
<div class="line"><span class="lineno">  243</span>                                                  self.enctlv_len)</div>
<div class="line"><span class="lineno">  244</span>                trailer_addr = (self.base_addr + self.slot_size) - trailer_size</div>
<div class="line"><span class="lineno">  245</span>                <span class="keywordflow">if</span> self.confirm <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.overwrite_only:</div>
<div class="line"><span class="lineno">  246</span>                    magic_size = 16</div>
<div class="line"><span class="lineno">  247</span>                    magic_align_size = align_up(magic_size, self.max_align)</div>
<div class="line"><span class="lineno">  248</span>                    image_ok_idx = -(magic_align_size + self.max_align)</div>
<div class="line"><span class="lineno">  249</span>                    flag = bytearray([self.erased_val] * magic_align_size)</div>
<div class="line"><span class="lineno">  250</span>                    flag[0] = 0x01 <span class="comment"># image_ok = 0x01</span></div>
<div class="line"><span class="lineno">  251</span>                    h.puts(trailer_addr + image_ok_idx, bytes(flag))</div>
<div class="line"><span class="lineno">  252</span>                h.puts(trailer_addr + (trailer_size - len(self.boot_magic)),</div>
<div class="line"><span class="lineno">  253</span>                       bytes(self.boot_magic))</div>
<div class="line"><span class="lineno">  254</span>            h.tofile(path, <span class="stringliteral">&#39;hex&#39;</span>)</div>
<div class="line"><span class="lineno">  255</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  256</span>            <span class="keywordflow">if</span> self.pad:</div>
<div class="line"><span class="lineno">  257</span>                self.pad_to(self.slot_size)</div>
<div class="line"><span class="lineno">  258</span>            <span class="keyword">with</span> open(path, <span class="stringliteral">&#39;wb&#39;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  259</span>                f.write(self.payload)</div>
<div class="line"><span class="lineno">  260</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a2dfc4f3822963e9ea5dc5d02509a6ac7" name="a2dfc4f3822963e9ea5dc5d02509a6ac7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dfc4f3822963e9ea5dc5d02509a6ac7">&#9670;&#160;</a></span>save() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">save </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>path</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>hex_addr</em><span class="paramdefsep"> = </span><span class="paramdefval">None</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Save an image from a given file</pre> 
<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00210">210</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  210</span>    <span class="keyword">def </span>save(self, path, hex_addr=None):</div>
<div class="line"><span class="lineno">  211</span>        <span class="stringliteral">&quot;&quot;&quot;Save an image from a given file&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  212</span>        ext = os.path.splitext(path)[1][1:].lower()</div>
<div class="line"><span class="lineno">  213</span>        <span class="keywordflow">if</span> ext == INTEL_HEX_EXT:</div>
<div class="line"><span class="lineno">  214</span>            <span class="comment"># input was in binary format, but HEX needs to know the base addr</span></div>
<div class="line"><span class="lineno">  215</span>            <span class="keywordflow">if</span> self.base_addr <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> hex_addr <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  216</span>                <span class="keywordflow">raise</span> click.UsageError(<span class="stringliteral">&quot;No address exists in input file &quot;</span></div>
<div class="line"><span class="lineno">  217</span>                                       <span class="stringliteral">&quot;neither was it provided by user&quot;</span>)</div>
<div class="line"><span class="lineno">  218</span>            h = IntelHex()</div>
<div class="line"><span class="lineno">  219</span>            <span class="keywordflow">if</span> hex_addr <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  220</span>                self.base_addr = hex_addr</div>
<div class="line"><span class="lineno">  221</span>            h.frombytes(bytes=self.payload, offset=self.base_addr)</div>
<div class="line"><span class="lineno">  222</span>            <span class="keywordflow">if</span> self.pad:</div>
<div class="line"><span class="lineno">  223</span>                trailer_size = self._trailer_size(self.align, self.max_sectors,</div>
<div class="line"><span class="lineno">  224</span>                                                  self.overwrite_only,</div>
<div class="line"><span class="lineno">  225</span>                                                  self.enckey,</div>
<div class="line"><span class="lineno">  226</span>                                                  self.save_enctlv,</div>
<div class="line"><span class="lineno">  227</span>                                                  self.enctlv_len)</div>
<div class="line"><span class="lineno">  228</span>                trailer_addr = (self.base_addr + self.slot_size) - trailer_size</div>
<div class="line"><span class="lineno">  229</span>                padding = bytearray([self.erased_val] * </div>
<div class="line"><span class="lineno">  230</span>                                    (trailer_size - len(boot_magic)))</div>
<div class="line"><span class="lineno">  231</span>                <span class="keywordflow">if</span> self.confirm <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.overwrite_only:</div>
<div class="line"><span class="lineno">  232</span>                    padding[-MAX_ALIGN] = 0x01  <span class="comment"># image_ok = 0x01</span></div>
<div class="line"><span class="lineno">  233</span>                padding += boot_magic</div>
<div class="line"><span class="lineno">  234</span>                h.puts(trailer_addr, bytes(padding))</div>
<div class="line"><span class="lineno">  235</span>            h.tofile(path, <span class="stringliteral">&#39;hex&#39;</span>)</div>
<div class="line"><span class="lineno">  236</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  237</span>            <span class="keywordflow">if</span> self.pad:</div>
<div class="line"><span class="lineno">  238</span>                self.pad_to(self.slot_size)</div>
<div class="line"><span class="lineno">  239</span>            <span class="keyword">with</span> open(path, <span class="stringliteral">&#39;wb&#39;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  240</span>                f.write(self.payload)</div>
<div class="line"><span class="lineno">  241</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ac250de8e12b6915166834bc0be6eff8b" name="ac250de8e12b6915166834bc0be6eff8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac250de8e12b6915166834bc0be6eff8b">&#9670;&#160;</a></span>verify() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">verify </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>imgfile</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00574">574</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  574</span>    <span class="keyword">def </span>verify(imgfile, key):</div>
<div class="line"><span class="lineno">  575</span>        <span class="keyword">with</span> open(imgfile, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  576</span>            b = f.read()</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>        magic, _, header_size, _, img_size = struct.unpack(<span class="stringliteral">&#39;IIHHI&#39;</span>, b[:16])</div>
<div class="line"><span class="lineno">  579</span>        version = struct.unpack(<span class="stringliteral">&#39;BBHI&#39;</span>, b[20:28])</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>        <span class="keywordflow">if</span> magic != IMAGE_MAGIC:</div>
<div class="line"><span class="lineno">  582</span>            <span class="keywordflow">return</span> VerifyResult.INVALID_MAGIC, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>        tlv_off = header_size + img_size</div>
<div class="line"><span class="lineno">  585</span>        tlv_info = b[tlv_off:tlv_off+TLV_INFO_SIZE]</div>
<div class="line"><span class="lineno">  586</span>        magic, tlv_tot = struct.unpack(<span class="stringliteral">&#39;HH&#39;</span>, tlv_info)</div>
<div class="line"><span class="lineno">  587</span>        <span class="keywordflow">if</span> magic == TLV_PROT_INFO_MAGIC:</div>
<div class="line"><span class="lineno">  588</span>            tlv_off += tlv_tot</div>
<div class="line"><span class="lineno">  589</span>            tlv_info = b[tlv_off:tlv_off+TLV_INFO_SIZE]</div>
<div class="line"><span class="lineno">  590</span>            magic, tlv_tot = struct.unpack(<span class="stringliteral">&#39;HH&#39;</span>, tlv_info)</div>
<div class="line"><span class="lineno">  591</span> </div>
<div class="line"><span class="lineno">  592</span>        <span class="keywordflow">if</span> magic != TLV_INFO_MAGIC:</div>
<div class="line"><span class="lineno">  593</span>            <span class="keywordflow">return</span> VerifyResult.INVALID_TLV_INFO_MAGIC, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  594</span> </div>
<div class="line"><span class="lineno">  595</span>        sha = hashlib.sha256()</div>
<div class="line"><span class="lineno">  596</span>        prot_tlv_size = tlv_off</div>
<div class="line"><span class="lineno">  597</span>        sha.update(b[:prot_tlv_size])</div>
<div class="line"><span class="lineno">  598</span>        digest = sha.digest()</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>        tlv_end = tlv_off + tlv_tot</div>
<div class="line"><span class="lineno">  601</span>        tlv_off += TLV_INFO_SIZE  <span class="comment"># skip tlv info</span></div>
<div class="line"><span class="lineno">  602</span>        <span class="keywordflow">while</span> tlv_off &lt; tlv_end:</div>
<div class="line"><span class="lineno">  603</span>            tlv = b[tlv_off:tlv_off+TLV_SIZE]</div>
<div class="line"><span class="lineno">  604</span>            tlv_type, _, tlv_len = struct.unpack(<span class="stringliteral">&#39;BBH&#39;</span>, tlv)</div>
<div class="line"><span class="lineno">  605</span>            <span class="keywordflow">if</span> tlv_type == TLV_VALUES[<span class="stringliteral">&quot;SHA256&quot;</span>]:</div>
<div class="line"><span class="lineno">  606</span>                off = tlv_off + TLV_SIZE</div>
<div class="line"><span class="lineno">  607</span>                <span class="keywordflow">if</span> digest == b[off:off+tlv_len]:</div>
<div class="line"><span class="lineno">  608</span>                    <span class="keywordflow">if</span> key <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  609</span>                        <span class="keywordflow">return</span> VerifyResult.OK, version, digest</div>
<div class="line"><span class="lineno">  610</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  611</span>                    <span class="keywordflow">return</span> VerifyResult.INVALID_HASH, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  612</span>            <span class="keywordflow">elif</span> key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> tlv_type == TLV_VALUES[key.sig_tlv()]:</div>
<div class="line"><span class="lineno">  613</span>                off = tlv_off + TLV_SIZE</div>
<div class="line"><span class="lineno">  614</span>                tlv_sig = b[off:off+tlv_len]</div>
<div class="line"><span class="lineno">  615</span>                payload = b[:prot_tlv_size]</div>
<div class="line"><span class="lineno">  616</span>                <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  617</span>                    <span class="keywordflow">if</span> hasattr(key, <span class="stringliteral">&#39;verify&#39;</span>):</div>
<div class="line"><span class="lineno">  618</span>                        key.verify(tlv_sig, payload)</div>
<div class="line"><span class="lineno">  619</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  620</span>                        key.verify_digest(tlv_sig, digest)</div>
<div class="line"><span class="lineno">  621</span>                    <span class="keywordflow">return</span> VerifyResult.OK, version, digest</div>
<div class="line"><span class="lineno">  622</span>                <span class="keywordflow">except</span> InvalidSignature:</div>
<div class="line"><span class="lineno">  623</span>                    <span class="comment"># continue to next TLV</span></div>
<div class="line"><span class="lineno">  624</span>                    <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">  625</span>            tlv_off += TLV_SIZE + tlv_len</div>
<div class="line"><span class="lineno">  626</span>        <span class="keywordflow">return</span> VerifyResult.INVALID_SIGNATURE, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac250de8e12b6915166834bc0be6eff8b" name="ac250de8e12b6915166834bc0be6eff8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac250de8e12b6915166834bc0be6eff8b">&#9670;&#160;</a></span>verify() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">verify </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>imgfile</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html#l00541">541</a> of file <a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  541</span>    <span class="keyword">def </span>verify(imgfile, key):</div>
<div class="line"><span class="lineno">  542</span>        <span class="keyword">with</span> open(imgfile, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  543</span>            b = f.read()</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>        magic, _, header_size, _, img_size = struct.unpack(<span class="stringliteral">&#39;IIHHI&#39;</span>, b[:16])</div>
<div class="line"><span class="lineno">  546</span>        version = struct.unpack(<span class="stringliteral">&#39;BBHI&#39;</span>, b[20:28])</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>        <span class="keywordflow">if</span> magic != IMAGE_MAGIC:</div>
<div class="line"><span class="lineno">  549</span>            <span class="keywordflow">return</span> VerifyResult.INVALID_MAGIC, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  550</span> </div>
<div class="line"><span class="lineno">  551</span>        tlv_info = b[header_size+img_size:header_size+img_size+TLV_INFO_SIZE]</div>
<div class="line"><span class="lineno">  552</span>        magic, tlv_tot = struct.unpack(<span class="stringliteral">&#39;HH&#39;</span>, tlv_info)</div>
<div class="line"><span class="lineno">  553</span>        <span class="keywordflow">if</span> magic != TLV_INFO_MAGIC:</div>
<div class="line"><span class="lineno">  554</span>            <span class="keywordflow">return</span> VerifyResult.INVALID_TLV_INFO_MAGIC, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>        sha = hashlib.sha256()</div>
<div class="line"><span class="lineno">  557</span>        sha.update(b[:header_size+img_size])</div>
<div class="line"><span class="lineno">  558</span>        digest = sha.digest()</div>
<div class="line"><span class="lineno">  559</span> </div>
<div class="line"><span class="lineno">  560</span>        tlv_off = header_size + img_size</div>
<div class="line"><span class="lineno">  561</span>        tlv_end = tlv_off + tlv_tot</div>
<div class="line"><span class="lineno">  562</span>        tlv_off += TLV_INFO_SIZE  <span class="comment"># skip tlv info</span></div>
<div class="line"><span class="lineno">  563</span>        <span class="keywordflow">while</span> tlv_off &lt; tlv_end:</div>
<div class="line"><span class="lineno">  564</span>            tlv = b[tlv_off:tlv_off+TLV_SIZE]</div>
<div class="line"><span class="lineno">  565</span>            tlv_type, _, tlv_len = struct.unpack(<span class="stringliteral">&#39;BBH&#39;</span>, tlv)</div>
<div class="line"><span class="lineno">  566</span>            <span class="keywordflow">if</span> tlv_type == TLV_VALUES[<span class="stringliteral">&quot;SHA256&quot;</span>]:</div>
<div class="line"><span class="lineno">  567</span>                off = tlv_off + TLV_SIZE</div>
<div class="line"><span class="lineno">  568</span>                <span class="keywordflow">if</span> digest == b[off:off+tlv_len]:</div>
<div class="line"><span class="lineno">  569</span>                    <span class="keywordflow">if</span> key <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  570</span>                        <span class="keywordflow">return</span> VerifyResult.OK, version, digest</div>
<div class="line"><span class="lineno">  571</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  572</span>                    <span class="keywordflow">return</span> VerifyResult.INVALID_HASH, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  573</span>            <span class="keywordflow">elif</span> key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> tlv_type == TLV_VALUES[key.sig_tlv()]:</div>
<div class="line"><span class="lineno">  574</span>                off = tlv_off + TLV_SIZE</div>
<div class="line"><span class="lineno">  575</span>                tlv_sig = b[off:off+tlv_len]</div>
<div class="line"><span class="lineno">  576</span>                payload = b[:header_size+img_size]</div>
<div class="line"><span class="lineno">  577</span>                <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  578</span>                    <span class="keywordflow">if</span> hasattr(key, <span class="stringliteral">&#39;verify&#39;</span>):</div>
<div class="line"><span class="lineno">  579</span>                        key.verify(tlv_sig, payload)</div>
<div class="line"><span class="lineno">  580</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  581</span>                        key.verify_digest(tlv_sig, digest)</div>
<div class="line"><span class="lineno">  582</span>                    <span class="keywordflow">return</span> VerifyResult.OK, version, digest</div>
<div class="line"><span class="lineno">  583</span>                <span class="keywordflow">except</span> InvalidSignature:</div>
<div class="line"><span class="lineno">  584</span>                    <span class="comment"># continue to next TLV</span></div>
<div class="line"><span class="lineno">  585</span>                    <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">  586</span>            tlv_off += TLV_SIZE + tlv_len</div>
<div class="line"><span class="lineno">  587</span>        <span class="keywordflow">return</span> VerifyResult.INVALID_SIGNATURE, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a6c52c4bac77f6744fdc338766e9e8a6f" name="a6c52c4bac77f6744fdc338766e9e8a6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c52c4bac77f6744fdc338766e9e8a6f">&#9670;&#160;</a></span>align</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">align</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00145">145</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a22ab7e27a72864f768a6b755eda2ccfb" name="a22ab7e27a72864f768a6b755eda2ccfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22ab7e27a72864f768a6b755eda2ccfb">&#9670;&#160;</a></span>base_addr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">base_addr</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00150">150</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a2f6749af3466b82f4c8a02db32d05393" name="a2f6749af3466b82f4c8a02db32d05393"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f6749af3466b82f4c8a02db32d05393">&#9670;&#160;</a></span>boot_magic</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boot_magic</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00161">161</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a80eab7ef497bc82f028bda0b735f7727" name="a80eab7ef497bc82f028bda0b735f7727"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80eab7ef497bc82f028bda0b735f7727">&#9670;&#160;</a></span>confirm</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">confirm</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00144">144</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a9f829b459875878369da661bb9d9abda" name="a9f829b459875878369da661bb9d9abda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f829b459875878369da661bb9d9abda">&#9670;&#160;</a></span>enckey</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enckey</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00155">155</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a651723b133106cb91db016c5b634a7b6" name="a651723b133106cb91db016c5b634a7b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a651723b133106cb91db016c5b634a7b6">&#9670;&#160;</a></span>enctlv_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enctlv_len</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00157">157</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="aceb52d5e58265d474290d1e17bcf1716" name="aceb52d5e58265d474290d1e17bcf1716"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aceb52d5e58265d474290d1e17bcf1716">&#9670;&#160;</a></span>endian</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">endian</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00149">149</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a5fc1d58df4dc5f022d49e58729217aaa" name="a5fc1d58df4dc5f022d49e58729217aaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fc1d58df4dc5f022d49e58729217aaa">&#9670;&#160;</a></span>erased_val</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">erased_val</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00153">153</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="aa6505cb356927cbac12d2af8dac8651b" name="aa6505cb356927cbac12d2af8dac8651b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6505cb356927cbac12d2af8dac8651b">&#9670;&#160;</a></span>header_size</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">header_size</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00141">141</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a0ece5abf498c14f7e723a0ea201f2356" name="a0ece5abf498c14f7e723a0ea201f2356"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ece5abf498c14f7e723a0ea201f2356">&#9670;&#160;</a></span>load_addr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">load_addr</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00151">151</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="ab3751a7bf9489f96727a62232ad9d7d5" name="ab3751a7bf9489f96727a62232ad9d7d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3751a7bf9489f96727a62232ad9d7d5">&#9670;&#160;</a></span>max_align</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">max_align</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00158">158</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="aba7c3d70c64b6a3e93ebcc28e2c36521" name="aba7c3d70c64b6a3e93ebcc28e2c36521"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba7c3d70c64b6a3e93ebcc28e2c36521">&#9670;&#160;</a></span>max_sectors</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">max_sectors</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00147">147</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="ad3c66df158b3cb95366d7639fd66e7fb" name="ad3c66df158b3cb95366d7639fd66e7fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3c66df158b3cb95366d7639fd66e7fb">&#9670;&#160;</a></span>overwrite_only</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">overwrite_only</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00148">148</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a85ab2d9278949e16f4c77f1b5daf342d" name="a85ab2d9278949e16f4c77f1b5daf342d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85ab2d9278949e16f4c77f1b5daf342d">&#9670;&#160;</a></span>pad</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pad</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00143">143</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="ab93b5446e5640d11ee66e87a5a347e30" name="ab93b5446e5640d11ee66e87a5a347e30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab93b5446e5640d11ee66e87a5a347e30">&#9670;&#160;</a></span>pad_header</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pad_header</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00142">142</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="aeabb6226e68bbbbb995aa6af5d999d11" name="aeabb6226e68bbbbb995aa6af5d999d11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeabb6226e68bbbbb995aa6af5d999d11">&#9670;&#160;</a></span>payload</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">payload</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00154">154</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="ac1fe150a3ea42a43271e6bec10231675" name="ac1fe150a3ea42a43271e6bec10231675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1fe150a3ea42a43271e6bec10231675">&#9670;&#160;</a></span>rom_fixed</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rom_fixed</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00152">152</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="ab3196255cca37d29a5ed0ac49c417129" name="ab3196255cca37d29a5ed0ac49c417129"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3196255cca37d29a5ed0ac49c417129">&#9670;&#160;</a></span>save_enctlv</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">save_enctlv</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00156">156</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a8e2f7509fd83c863081352c1c941a835" name="a8e2f7509fd83c863081352c1c941a835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e2f7509fd83c863081352c1c941a835">&#9670;&#160;</a></span>security_counter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">security_counter</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00178">178</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="aa688bccf026647ce81122f09a9dd5d37" name="aa688bccf026647ce81122f09a9dd5d37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa688bccf026647ce81122f09a9dd5d37">&#9670;&#160;</a></span>slot_size</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">slot_size</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00146">146</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<a id="a4c7a521b8f1a0769c09bfa4a1fca7dab" name="a4c7a521b8f1a0769c09bfa4a1fca7dab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c7a521b8f1a0769c09bfa4a1fca7dab">&#9670;&#160;</a></span>version</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">version</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="imgtool_2image_8py_source.html#l00140">140</a> of file <a class="el" href="imgtool_2image_8py_source.html">image.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/harrkout/github/Leshan-OMA-Lightweight-M2M-server-for-Zephyr-/scripts/imgtool/<a class="el" href="imgtool_2image_8py_source.html">image.py</a></li>
<li>/home/harrkout/github/Leshan-OMA-Lightweight-M2M-server-for-Zephyr-/scripts/imgtool_1.7.2/imgtool/<a class="el" href="imgtool__1_87_82_2imgtool_2image_8py_source.html">image.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceimgtool.html">imgtool</a></li><li class="navelem"><a class="el" href="namespaceimgtool_1_1image.html">image</a></li><li class="navelem"><a class="el" href="classimgtool_1_1image_1_1Image.html">Image</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
