<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32-Time-of-Flight-VL53L0X-Zephyr-RTOS: STM32-Time-of-Flight-VL53L0X-Zephyr-RTOS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM32-Time-of-Flight-VL53L0X-Zephyr-RTOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">STM32-Time-of-Flight-VL53L0X-Zephyr-RTOS </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Code documentation.</p>
<ul>
<li>ReadMe</li>
</ul>
<p>VL53L0X: Time Of Flight sensor </p><h6></h6>
<p>Overview </p><hr  />
<p> This sample periodically measures distance between vl53l0x sensor and target. The result is displayed on the console. It also shows how we can use the vl53l0x as a proximity sensor.</p>
<p>Requirements </p><hr  />
<p>This sample uses the VL53L0X sensor controlled using the I2C interface.</p>
<p>References </p><hr  />
<ul>
<li>VL53L0X: <a href="http://www.st.com/en/imaging-and-photonics-solutions/vl53l0x.html">http://www.st.com/en/imaging-and-photonics-solutions/vl53l0x.html</a></li>
</ul>
<p>Building and Running </p><hr  />
<p>This project outputs sensor data to the console. It requires a VL53L0X sensor, which is present on the disco_l475_iot1 board.</p>
<p>.. zephyr-app-commands:: :app: samples/sensor/vl53l0x/ :goals: build flash</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Sample Output</h1>
<p>.. code-block:: console</p>
<p>prox is 0 distance is 1938 prox is 1 distance is 70 prox is 0 distance is 1995</p>
<p>&lt;repeats endlessly every second&gt;</p>
<h6></h6>
<p>Golioth Light DB stream sample </p><h6></h6>
<p>Overview </p><hr  />
<p>This Light DB stream application demonstrates how to connect with Golioth and periodically send data to Light DB stream. In this sample temperature measurements are sent to <code>/temp</code> Light DB stream path. For platforms that do not have temperature sensor a value is generated from 20 up to 30.</p>
<p>Requirements </p><hr  />
<ul>
<li>Golioth credentials</li>
<li>Network connectivity</li>
</ul>
<p>Building and Running </p><hr  />
<p>Configure the following Kconfig options based on your Golioth credentials:</p>
<ul>
<li>GOLIOTH_SYSTEM_CLIENT_PSK_ID - PSK ID of registered device</li>
<li>GOLIOTH_SYSTEM_CLIENT_PSK - PSK of registered device</li>
</ul>
<p>by adding these lines to configuration file (e.g. <code>prj.conf</code>):</p>
<p>.. code-block:: cfg</p>
<p>CONFIG_GOLIOTH_SYSTEM_CLIENT_PSK_ID="my-psk-id" CONFIG_GOLIOTH_SYSTEM_CLIENT_PSK="my-psk"</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Platform specific configuration</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
QEMU</h2>
<p>This application has been built and tested with QEMU x86 (qemu_x86).</p>
<p>On your Linux host computer, open a terminal window, locate the source code of this sample application (i.e., <code>samples/lightdb_stream</code>) and type:</p>
<p>.. code-block:: console</p>
<p>$ west build -b qemu_x86 samples/lightdb_stream $ west build -t run</p>
<p>See <code>Networking with QEMU</code>_ on how to setup networking on host and configure NAT/masquerading to access Internet.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
ESP32</h2>
<p>Configure the following Kconfig options based on your WiFi AP credentials:</p>
<ul>
<li>GOLIOTH_SAMPLE_WIFI_SSID - WiFi SSID</li>
<li>GOLIOTH_SAMPLE_WIFI_PSK - WiFi PSK</li>
</ul>
<p>by adding these lines to configuration file (e.g. <code>prj.conf</code> or <code>board/esp32.conf</code>):</p>
<p>.. code-block:: cfg</p>
<p>CONFIG_GOLIOTH_SAMPLE_WIFI_SSID="my-wifi" CONFIG_GOLIOTH_SAMPLE_WIFI_PSK="my-psk"</p>
<p>On your host computer open a terminal window, locate the source code of this sample application (i.e., <code>samples/lightdb_stream</code>) and type:</p>
<p>.. code-block:: console</p>
<p>$ west build -b esp32 samples/lightdb_stream $ west flash</p>
<p>See <code>ESP32</code>_ for details on how to use ESP32 board.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
nRF52840 DK + ESP32-WROOM-32</h2>
<p>This subsection documents using nRF52840 DK running Zephyr with offloaded ESP-AT WiFi driver and ESP32-WROOM-32 module based board (such as ESP32 DevkitC rev. 4) running WiFi stack. See <code>AT Binary Lists</code>_ for links to ESP-AT binaries and details on how to flash ESP-AT image on ESP chip. Flash ESP chip with following command:</p>
<p>.. code-block:: console</p>
<p>esptool.py write_flash &ndash;verify 0x0 PATH_TO_ESP_AT/factory/factory_WROOM-32.bin</p>
<p>Connect nRF52840 DK and ESP32-DevKitC V4 (or other ESP32-WROOM-32 based board) using wires:</p>
<p>+--------&mdash;+-----------&mdash;+ |nRF52840 DK|ESP32-WROOM-32| | | | +--------&mdash;+-----------&mdash;+ |P1.01 (RX) |IO17 (TX) | +--------&mdash;+-----------&mdash;+ |P1.02 (TX) |IO16 (RX) | +--------&mdash;+-----------&mdash;+ |P1.03 (CTS)|IO14 (RTS) | +--------&mdash;+-----------&mdash;+ |P1.04 (RTS)|IO15 (CTS) | +--------&mdash;+-----------&mdash;+ |P1.05 |EN | +--------&mdash;+-----------&mdash;+ |GND |GND | +--------&mdash;+-----------&mdash;+</p>
<p>Configure the following Kconfig options based on your WiFi AP credentials:</p>
<ul>
<li>GOLIOTH_SAMPLE_WIFI_SSID - WiFi SSID</li>
<li>GOLIOTH_SAMPLE_WIFI_PSK - WiFi PSK</li>
</ul>
<p>by adding these lines to configuration file (e.g. <code>prj.conf</code> or <code>board/nrf52840dk_nrf52840.conf</code>):</p>
<p>.. code-block:: cfg</p>
<p>CONFIG_GOLIOTH_SAMPLE_WIFI_SSID="my-wifi" CONFIG_GOLIOTH_SAMPLE_WIFI_PSK="my-psk"</p>
<p>On your host computer open a terminal window, locate the source code of this sample application (i.e., <code>samples/lightdb_stream</code>) and type:</p>
<p>.. code-block:: console</p>
<p>$ west build -b nrf52840dk_nrf52840 samples/lightdb_stream $ west flash</p>
<h2><a class="anchor" id="autotoc_md5"></a>
nRF9160 DK</h2>
<p>On your host computer open a terminal window, locate the source code of this sample application (i.e., <code>samples/ligthdb_stream</code>) and type:</p>
<p>.. code-block:: console</p>
<p>$ west build -b nrf9160dk_nrf9160_ns samples/lightdb_stream $ west flash</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Sample output</h1>
<p>This is the output from the serial console:</p>
<p>.. code-block:: console</p>
<p>[00:00:00.000,000] &lt;inf&gt; golioth_system: Initializing [00:00:00.000,000] &lt;inf&gt; net_config: Initializing network [00:00:00.000,000] &lt;inf&gt; net_config: IPv4 address: 192.0.2.1 [00:00:00.000,000] &lt;dbg&gt; golioth_lightdb_stream.main: Start Light DB stream sample [00:00:00.000,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 20.000000 [00:00:00.000,000] &lt;inf&gt; golioth_system: Starting connect [00:00:00.010,000] &lt;inf&gt; golioth_system: Client connected! [00:00:05.010,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 20.500000 [00:00:10.040,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 21.000000 [00:00:15.050,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 21.500000 [00:00:20.060,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 22.000000 [00:00:25.070,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 22.500000 [00:00:30.080,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 23.000000 [00:00:35.090,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 23.500000 [00:00:40.100,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 24.000000 [00:00:45.110,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 24.500000 [00:00:50.120,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 25.000000 [00:00:55.130,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 25.500000 [00:01:00.140,000] &lt;dbg&gt; golioth_lightdb_stream.main: Sending temperature 26.000000</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Monitor temperature value over time</h1>
<p>Device sends temperature measurements every 5s and updates <code>/temp</code> resource in Light DB stream. Current value can be fetched using following command:</p>
<p>.. code-block:: console</p>
<p>$ goliothctl stream get &lt;device-id&gt; /temp 26</p>
<p>Historical data can be queried using following command:</p>
<p>.. code-block:: console</p>
<p>$ goliothctl stream query &ndash;interval 5m &ndash;field time &ndash;field temp | jq '' [ { "temp": 26, "time": "2021-06-08 12:17:01.158 +0000 UTC" }, { "temp": 25.5, "time": "2021-06-08 12:16:56.146 +0000 UTC" }, { "temp": 25, "time": "2021-06-08 12:16:51.138 +0000 UTC" }, { "temp": 24.5, "time": "2021-06-08 12:16:46.126 +0000 UTC" }, { "temp": 24, "time": "2021-06-08 12:16:41.114 +0000 UTC" }, { "temp": 23.5, "time": "2021-06-08 12:16:36.108 +0000 UTC" }, { "temp": 23, "time": "2021-06-08 12:16:31.098 +0000 UTC" }, { "temp": 22.5, "time": "2021-06-08 12:16:26.088 +0000 UTC" }, { "temp": 22, "time": "2021-06-08 12:16:21.078 +0000 UTC" }, { "temp": 21.5, "time": "2021-06-08 12:16:16.068 +0000 UTC" }, { "temp": 21, "time": "2021-06-08 12:16:11.054 +0000 UTC" }, { "temp": 20.5, "time": "2021-06-08 12:16:06.049 +0000 UTC" } ]</p>
<p>.. _Networking with QEMU: <a href="https://docs.zephyrproject.org/3.0.0/guides/networking/qemu_setup.html#networking-with-qemu">https://docs.zephyrproject.org/3.0.0/guides/networking/qemu_setup.html#networking-with-qemu</a> .. _ESP32: <a href="https://docs.zephyrproject.org/3.0.0/boards/xtensa/esp32/doc/index.html">https://docs.zephyrproject.org/3.0.0/boards/xtensa/esp32/doc/index.html</a> .. _AT Binary Lists: <a href="https://docs.espressif.com/projects/esp-at/en/latest/AT_Binary_Lists/index.html">https://docs.espressif.com/projects/esp-at/en/latest/AT_Binary_Lists/index.html</a> </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
